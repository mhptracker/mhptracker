<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PGR Tracker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Oswald:wght@500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        :root {
            --bg: #1a1a1f;
            --bg-card: rgba(255,255,255,0.04);
            --bg-card-hover: rgba(255,255,255,0.08);
            --border: rgba(255,255,255,0.10);
            --border-hover: rgba(255,255,255,0.18);
            --text: #ffffff;
            --text-secondary: rgba(255,255,255,0.55);
            --text-tertiary: rgba(255,255,255,0.3);
            --accent: #0A84FF;
            --gold: #FFD60A;
            --gold-glow: rgba(255,214,10,0.3);
            --radius: 12px;
            --radius-sm: 8px;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.5;
            font-size: 14px;
            -webkit-font-smoothing: antialiased;
        }

        .app {
            display: flex;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100); /* JS-calculated viewport height for mobile */
            height: 100dvh; /* Dynamic viewport height - best support */
        }

        /* Sidebar */
        .sidebar {
            width: 220px;
            padding: 24px 16px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--border);
            flex-shrink: 0;
        }

        .logo {
            font-family: 'Oswald', sans-serif;
            font-size: 18px;
            font-weight: 600;
            letter-spacing: 0.06em;
            text-transform: uppercase;
            margin-bottom: 32px;
            padding: 0 8px;
        }

        .logo-progressive {
            color: var(--accent);
        }

        .nav {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: var(--radius-sm);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 14px;
            font-weight: 450;
        }

        .nav-item:hover {
            background: var(--bg-card);
            color: var(--text);
        }

        .nav-item.active {
            background: var(--bg-card-hover);
            color: var(--text);
        }

        .nav-item svg {
            width: 18px;
            height: 18px;
            opacity: 0.7;
        }

        .nav-divider {
            height: 1px;
            background: var(--border);
            margin: 12px 0;
        }

        .nav-footer {
            padding: 12px;
            color: var(--text-tertiary);
            font-size: 12px;
        }

        /* Sidebar Mini Calendar */
        .sidebar-calendar {
            margin: 16px 8px;
            padding: 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }
        .sidebar-calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
            gap: 4px;
        }
        .sidebar-calendar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: opacity 0.3s ease;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 4px;
        }
        .sidebar-calendar-title:hover {
            background: var(--bg-card-hover);
            color: var(--text);
        }
        .sidebar-cal-nav {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .sidebar-cal-nav-btn {
            background: transparent;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
        }
        .sidebar-cal-nav-btn:hover {
            background: var(--bg-card-hover);
            color: var(--text);
        }
        .sidebar-cal-nav-btn svg {
            width: 12px;
            height: 12px;
        }
        .sidebar-calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            transition: opacity 0.3s ease;
        }
        .sidebar-calendar-weekday {
            text-align: center;
            font-size: 8px;
            font-weight: 600;
            color: var(--text-tertiary);
            padding: 4px 0;
        }
        .sidebar-calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: var(--text-tertiary);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
        }
        .sidebar-calendar-day:hover { background: var(--bg-card-hover); }
        .sidebar-calendar-day.today {
            position: relative;
            font-weight: 700;
            color: var(--text);
        }
        .sidebar-calendar-day.today::after {
            content: '';
            position: absolute;
            bottom: 2px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: var(--text);
            border-radius: 50%;
        }
        .sidebar-calendar-day.has-entries {
            color: var(--text);
            font-weight: 600;
        }
        .sidebar-cal-dots {
            position: absolute;
            bottom: 1px;
            display: flex;
            gap: 1px;
            justify-content: center;
        }
        .sidebar-cal-dot {
            width: 3px;
            height: 3px;
            border-radius: 50%;
        }
        .sidebar-calendar-day.selected {
            background: var(--accent);
            color: white !important;
        }
        .sidebar-calendar-day.selected .sidebar-cal-dot {
            box-shadow: 0 0 0 1px rgba(255,255,255,0.5);
        }
        @media (max-width: 1024px) { .sidebar-calendar { display: none; } }

        .data-actions {
            padding: 8px 12px;
            display: flex;
            gap: 8px;
        }

        .data-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-secondary);
            font-size: 12px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .data-btn:hover {
            background: var(--bg-card);
            border-color: var(--border-hover);
            color: var(--text);
        }

        /* Main */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* Header */
        .header {
            padding: 20px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .header h1 {
            font-size: 24px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        /* Year navigation */
        .year-nav {
            display: none;
            align-items: center;
            gap: 8px;
            margin-left: 12px;
        }

        .year-nav.visible {
            display: flex;
        }

        .year-nav-btn {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            padding: 0;
        }

        .year-nav-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            color: var(--text);
        }

        .year-nav-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text);
            min-width: 50px;
            text-align: center;
        }

        .search-box {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 8px 14px;
            width: 240px;
            transition: all 0.2s ease;
        }

        .search-box:focus-within {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
        }

        .search-box svg {
            width: 16px;
            height: 16px;
            color: var(--text-tertiary);
        }

        .search-box input {
            flex: 1;
            background: none;
            border: none;
            color: var(--text);
            font-size: 14px;
            outline: none;
        }

        .search-box input::placeholder {
            color: var(--text-tertiary);
        }

        /* Content */
        .content {
            flex: 1;
            overflow: hidden;
        }

        .view {
            display: none;
            height: 100%;
        }

        .view.active {
            display: flex;
        }

        /* Timeline View - Apple Minimalist */
        #timeline-view {
            width: 100%;
            overflow: hidden;
        }

        .timeline-scroll {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 0 32px 100px 100px;
            scroll-behavior: smooth;
        }

        .timeline-scroll::-webkit-scrollbar {
            width: 0;
        }

        .timeline-wrapper {
            position: relative;
            padding-left: 60px;
        }

        /* The main vertical line */
        .timeline-line {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom,
                transparent 0%,
                var(--border) 2%,
                var(--border) 98%,
                transparent 100%
            );
        }

        /* Month group */
        .month-section {
            margin-bottom: 8px;
        }

        .month-label {
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 16px 0 12px;
            font-size: 13px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-tertiary);
            background: linear-gradient(to bottom, var(--bg) 0%, var(--bg) 70%, transparent 100%);
        }

        /* Day row */
        .day-row {
            display: flex;
            align-items: flex-start;
            min-height: 28px;
            position: relative;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .day-row:hover .day-number {
            color: var(--text);
        }

        .day-row.selected .day-number {
            color: var(--text);
            font-weight: 600;
        }

        .day-row.today .day-number {
            color: var(--text);
            font-weight: 700;
            position: relative;
        }
        .day-row.today .day-number::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--text);
            border-radius: 1px;
        }
        .day-row.today .notch {
            box-shadow: 0 0 0 2px var(--text), 0 0 8px rgba(255,255,255,0.3);
        }

        /* Notch on the line */
        .notch {
            position: absolute;
            left: -46px;
            top: 8px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.2s ease;
            z-index: 2;
        }

        .day-row:hover .notch {
            transform: scale(1.3);
            background: var(--text-tertiary);
        }

        .day-row.selected .notch {
            transform: scale(1.4);
            background: var(--accent);
            box-shadow: 0 0 12px rgba(10, 132, 255, 0.5);
        }

        .day-row.expanded.has-entries .notch {
            transform: scale(1.5);
        }

        .day-row.has-entries .notch {
            width: 12px;
            height: 12px;
            top: 7px;
            left: -47px;
        }

        /* Multi-color lava lamp effect */
        @keyframes colorShift {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(30deg); }
        }

        .notch.multi {
            animation: colorShift 4s ease infinite;
        }

        /* Connector line from notch to entry */
        .connector {
            position: absolute;
            left: -34px;
            top: 12px;
            width: 34px;
            height: 2px;
            background: var(--border);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .day-row.has-entries .connector {
            opacity: 1;
        }

        .day-row.has-entries:hover .connector,
        .day-row.has-entries.selected .connector {
            background: var(--accent);
        }

        /* Day number */
        .day-number {
            position: absolute;
            left: -96px;
            top: 6px;
            width: 40px;
            text-align: right;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-tertiary);
            font-variant-numeric: tabular-nums;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            transform-origin: right center;
        }

        /* Expanded day: larger day number */
        .day-row.expanded .day-number {
            font-size: 28px;
            font-weight: 600;
            color: var(--text);
            top: -2px;
            left: -110px;
        }

        /* Entry cards on the timeline */
        .day-entries {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding: 2px 0 8px 0;
        }

        /* Slim card by default */
        .timeline-entry {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 10px 14px;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border-left: 3px solid var(--entry-color, var(--border));
            position: relative;
            overflow: hidden;
        }

        .timeline-entry::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, var(--entry-color, transparent) 0%, transparent 100%);
            opacity: 0.06;
            pointer-events: none;
            transition: opacity 0.25s ease;
        }

        .timeline-entry:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            transform: translateX(4px);
        }

        .timeline-entry:hover::before {
            opacity: 0.1;
        }

        .timeline-entry.accolade {
            border-left-color: var(--gold);
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(255,214,10,0.05) 100%);
        }

        /* Slim mode: hide extra content */
        .timeline-entry .entry-category-row,
        .timeline-entry .entry-person,
        .timeline-entry .entry-takeaways,
        .timeline-entry .entry-notes,
        .timeline-entry .entry-actions {
            display: none;
        }

        /* Expanded day: show all content */
        .day-row.expanded .timeline-entry {
            padding: 14px 16px;
        }

        .day-row.expanded .timeline-entry .entry-category-row,
        .day-row.expanded .timeline-entry .entry-person,
        .day-row.expanded .timeline-entry .entry-takeaways,
        .day-row.expanded .timeline-entry .entry-notes {
            display: block;
        }

        .day-row.expanded .timeline-entry:hover .entry-actions {
            display: flex;
        }

        .entry-category-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .entry-cat-label {
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
        }

        .entry-title {
            font-size: 14px;
            font-weight: 500;
            line-height: 1.4;
        }

        .day-row.expanded .timeline-entry .entry-title {
            font-size: 15px;
            margin-top: 6px;
        }

        .entry-title.gold {
            background: linear-gradient(90deg, var(--gold) 0%, #FFEA00 50%, var(--gold) 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        .entry-person {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .entry-person.linked {
            color: var(--accent);
        }

        /* Coaching entries special styling */
        .timeline-entry.coaching-entry,
        .entry-card.coaching-entry {
            border-color: rgba(94, 92, 230, 0.4);
            box-shadow: 0 0 20px rgba(94, 92, 230, 0.15), inset 0 0 20px rgba(94, 92, 230, 0.05);
        }

        .entry-takeaways {
            margin-top: 10px;
            padding: 10px 12px;
            background: rgba(94, 92, 230, 0.1);
            border-left: 3px solid #5E5CE6;
            border-radius: 0 6px 6px 0;
            font-size: 13px;
            color: var(--text);
            line-height: 1.5;
        }

        .entry-takeaways-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #5E5CE6;
            margin-bottom: 4px;
        }

        .takeaways-field {
            border-color: rgba(94, 92, 230, 0.4);
            background: rgba(94, 92, 230, 0.05);
        }

        .takeaways-field:focus {
            border-color: #5E5CE6;
            box-shadow: 0 0 0 3px rgba(94, 92, 230, 0.2);
        }

        .section-intro {
            color: var(--text-secondary);
            margin-bottom: 24px;
            font-size: 14px;
        }

        .entry-notes {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 6px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .entry-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .timeline-entry:hover .entry-actions {
            opacity: 1;
        }

        .entry-btn {
            padding: 5px 10px;
            border-radius: 6px;
            border: none;
            background: var(--bg-card-hover);
            color: var(--text-secondary);
            font-size: 12px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .entry-btn:hover {
            background: var(--border);
            color: var(--text);
        }

        .entry-btn.delete:hover {
            background: rgba(255,69,58,0.2);
            color: #FF453A;
        }

        /* Empty day placeholder */
        .empty-day-hint {
            font-size: 13px;
            color: var(--text-tertiary);
            padding: 4px 0;
            opacity: 0;
            transition: opacity 0.15s ease;
        }

        .day-row:hover .empty-day-hint {
            opacity: 1;
        }

        /* ===== TIMELINE ENHANCEMENTS ===== */

        /* Today Anchor Button */
        .today-anchor {
            position: fixed;
            bottom: 100px;
            right: 32px;
            padding: 10px 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 4px 20px rgba(10, 132, 255, 0.4);
        }

        .today-anchor.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .today-anchor:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 24px rgba(10, 132, 255, 0.5);
        }

        /* Timeline Filter Chips */
        .timeline-filters {
            display: flex;
            gap: 8px;
            padding: 0 0 16px 0;
            flex-wrap: wrap;
        }

        .timeline-filter-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .timeline-filter-chip:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
        }

        .timeline-filter-chip.active {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .timeline-filter-chip .chip-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .timeline-filter-chip.active .chip-dot {
            background: white !important;
        }

        /* Entry Count Badge */
        .entry-count-badge {
            position: absolute;
            left: -34px;
            top: 2px;
            min-width: 18px;
            height: 18px;
            padding: 0 5px;
            background: var(--accent);
            color: white;
            font-size: 10px;
            font-weight: 600;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.2s ease;
        }

        .day-row.has-entries .entry-count-badge {
            opacity: 1;
            transform: scale(1);
        }

        .day-row.expanded .entry-count-badge {
            opacity: 0;
            transform: scale(0.8);
        }


        /* Entry Type Icons */
        .entry-icon {
            margin-right: 6px;
            font-size: 14px;
        }

        /* Quick Add Inline */
        .quick-add-hint {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            color: var(--text-tertiary);
            font-size: 13px;
            opacity: 0;
            transition: all 0.2s ease;
            cursor: pointer;
            border-radius: var(--radius-sm);
        }

        .day-row:hover .quick-add-hint {
            opacity: 1;
        }

        .quick-add-hint:hover {
            background: var(--bg-card);
            color: var(--accent);
        }

        .quick-add-hint svg {
            width: 14px;
            height: 14px;
        }

        /* Staggered Entry Animation */
        @keyframes entrySlideIn {
            from {
                opacity: 0;
                transform: translateX(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .day-row.expanded .timeline-entry {
            animation: entrySlideIn 0.3s ease forwards;
        }

        .day-row.expanded .timeline-entry:nth-child(1) { animation-delay: 0ms; }
        .day-row.expanded .timeline-entry:nth-child(2) { animation-delay: 50ms; }
        .day-row.expanded .timeline-entry:nth-child(3) { animation-delay: 100ms; }
        .day-row.expanded .timeline-entry:nth-child(4) { animation-delay: 150ms; }
        .day-row.expanded .timeline-entry:nth-child(5) { animation-delay: 200ms; }

        /* Context Menu */
        .context-menu {
            position: fixed;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 6px;
            min-width: 160px;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0,0,0,0.4);
            opacity: 0;
            transform: scale(0.95);
            transition: all 0.15s ease;
            pointer-events: none;
        }

        .context-menu.visible {
            opacity: 1;
            transform: scale(1);
            pointer-events: auto;
        }

        .context-menu-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            font-size: 13px;
            color: var(--text);
            cursor: pointer;
            border-radius: var(--radius-sm);
            transition: background 0.15s ease;
        }

        .context-menu-item:hover {
            background: var(--bg-card-hover);
        }

        .context-menu-item.danger {
            color: #FF453A;
        }

        .context-menu-item.danger:hover {
            background: rgba(255,69,58,0.15);
        }

        .context-menu-divider {
            height: 1px;
            background: var(--border);
            margin: 6px 0;
        }

        .context-menu-item svg {
            width: 16px;
            height: 16px;
            opacity: 0.7;
        }

        /* Empty Month State */
        .empty-month-message {
            padding: 24px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 13px;
            font-style: italic;
        }

        /* Blue Glow on Expanded Day */
        .day-row.expanded {
            position: relative;
        }

        .day-row.expanded::before {
            content: '';
            position: absolute;
            left: -20px;
            right: -20px;
            top: -8px;
            bottom: -8px;
            background: linear-gradient(90deg, rgba(10, 132, 255, 0.08) 0%, rgba(10, 132, 255, 0.03) 100%);
            border-radius: var(--radius);
            z-index: -1;
            pointer-events: none;
        }

        /* Better Month Transitions */
        .month-section {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .month-section:last-child {
            border-bottom: none;
        }

        .month-label {
            position: sticky;
            top: 0;
            z-index: 10;
            padding: 20px 0 16px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            background: linear-gradient(to bottom, var(--bg) 0%, var(--bg) 80%, transparent 100%);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .month-entry-count {
            font-size: 11px;
            font-weight: 500;
            color: var(--text-tertiary);
            letter-spacing: 0;
            text-transform: none;
        }

        /* Keyboard navigation focus state */
        .day-row.keyboard-focus {
            outline: none;
        }

        .day-row.keyboard-focus .day-number {
            color: var(--accent);
        }

        .day-row.keyboard-focus .notch {
            transform: scale(1.4);
            box-shadow: 0 0 0 3px rgba(10, 132, 255, 0.3);
        }

        /* Floating Add Button */
        .fab {
            position: fixed;
            bottom: 32px;
            right: 32px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--accent);
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(10, 132, 255, 0.4);
            transition: all 0.2s ease;
            z-index: 100;
        }

        .fab:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 28px rgba(10, 132, 255, 0.5);
        }

        .fab:active {
            transform: scale(0.95);
        }

        /* Other Views - List Container */
        .list-container {
            flex: 1;
            overflow-y: auto;
            padding: 0 32px 100px;
        }

        .list-container::-webkit-scrollbar {
            width: 8px;
        }

        .list-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        /* People Grid */
        .people-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
            padding-top: 8px;
        }

        .person-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .person-card:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            transform: translateY(-2px);
        }

        .person-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: var(--bg-card-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 14px;
        }

        .person-name {
            font-size: 16px;
            font-weight: 600;
        }

        .person-role {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 2px;
        }

        .person-stats {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 12px;
        }

        .add-card {
            background: transparent;
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            padding: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 160px;
            color: var(--text-tertiary);
        }

        .add-card:hover {
            border-color: var(--border-hover);
            color: var(--text-secondary);
        }

        .add-card svg {
            width: 28px;
            height: 28px;
            margin-bottom: 8px;
        }

        /* Person Detail */
        .detail-header {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 24px 0;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border);
        }

        .detail-avatar {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--bg-card-hover);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            font-weight: 600;
            color: var(--accent);
        }

        .detail-info h2 {
            font-size: 24px;
            font-weight: 600;
        }

        .detail-info p {
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .detail-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--text-secondary);
            font-size: 14px;
            cursor: pointer;
            padding: 8px 0;
            transition: color 0.15s ease;
        }

        .back-link:hover {
            color: var(--text);
        }

        /* Form */
        .form-container {
            max-width: 560px;
            padding-top: 8px;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px 14px;
            color: var(--text);
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: var(--bg-card-hover);
        }

        .form-select {
            appearance: none;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24' fill='none' stroke='rgba(255,255,255,0.5)' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }

        /* Fix all dropdowns for dark mode */
        select option {
            background: #252529;
            color: #ffffff;
            padding: 8px;
        }

        select:focus option:checked {
            background: #3a3a42;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* Category radio buttons */
        .category-radios {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .category-radio {
            display: none;
        }

        .category-radio-label {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 14px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            background: var(--bg-card);
            cursor: pointer;
            transition: all 0.15s ease;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .category-radio-label:hover {
            border-color: var(--border-hover);
            background: var(--bg-card-hover);
        }

        .category-radio:checked + .category-radio-label {
            border-color: var(--accent);
            background: rgba(10, 132, 255, 0.15);
            color: var(--text);
        }

        .category-radio-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Settings dropdown */
        .settings-container {
            position: relative;
        }

        .settings-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--bg-card);
            color: var(--text-secondary);
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .settings-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            color: var(--text);
        }

        .settings-btn svg {
            width: 16px;
            height: 16px;
        }

        .settings-dropdown {
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: #252529;
            border: 1px solid var(--border-hover);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
            overflow: hidden;
            opacity: 0;
            visibility: hidden;
            transform: translateY(8px);
            transition: all 0.2s ease;
            z-index: 100;
        }

        .settings-dropdown.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .settings-dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 14px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
            background: none;
            width: 100%;
            text-align: left;
            font-family: inherit;
        }

        .settings-dropdown-item:hover {
            background: var(--bg-card-hover);
            color: var(--text);
        }

        .settings-dropdown-item svg {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .settings-dropdown-item.highlight {
            color: var(--gold);
        }

        .settings-dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 4px 0;
        }

        .btn {
            padding: 11px 20px;
            border-radius: var(--radius-sm);
            border: none;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            filter: brightness(1.1);
        }

        .btn-secondary {
            background: var(--bg-card-hover);
            color: var(--text);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-secondary.delete:hover {
            background: rgba(255,69,58,0.2);
            color: #FF453A;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        /* Categories */
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-width: 500px;
        }

        .category-item {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
        }

        .category-color {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            cursor: pointer;
            transition: transform 0.15s ease;
        }

        .category-color:hover {
            transform: scale(1.15);
        }

        .category-color.gold {
            background: linear-gradient(135deg, var(--gold) 0%, #FFEA00 100%);
        }

        .category-name-input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text);
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            outline: none;
        }

        .category-name-input:focus {
            background: var(--bg-card-hover);
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 4px;
        }

        .category-count {
            color: var(--text-tertiary);
            font-size: 13px;
        }

        .category-delete {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            border: none;
            background: transparent;
            color: var(--text-tertiary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
        }

        .category-delete:hover {
            background: rgba(255,69,58,0.2);
            color: #FF453A;
        }

        .add-category-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            border: 2px dashed var(--border);
            border-radius: var(--radius-sm);
            background: transparent;
            color: var(--text-tertiary);
            font-size: 14px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s ease;
            margin-top: 8px;
        }

        .add-category-btn:hover {
            border-color: var(--border-hover);
            color: var(--text-secondary);
        }

        /* Summary */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 700;
            color: var(--accent);
            line-height: 1;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 13px;
            margin-top: 6px;
        }

        .breakdown-section h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .breakdown-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 14px;
        }

        .breakdown-dot {
            width: 10px;
            height: 10px;
            border-radius: 3px;
        }

        .breakdown-label {
            width: 160px;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .breakdown-bar {
            flex: 1;
            height: 6px;
            background: var(--bg-card);
            border-radius: 3px;
            overflow: hidden;
        }

        .breakdown-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .breakdown-count {
            width: 32px;
            text-align: right;
            font-weight: 600;
            font-size: 14px;
        }

        /* Entries List */
        .filter-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-btn {
            padding: 7px 14px;
            border-radius: 20px;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            font-size: 13px;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .filter-btn:hover {
            border-color: var(--border-hover);
            color: var(--text);
        }

        .filter-btn.active {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            color: var(--text);
        }

        /* Calendar View - Make it responsive */
        .entries-calendar {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 24px;
            max-width: 100%;
            overflow: hidden;
        }

        .calendar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .calendar-nav-btn {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
        }

        .calendar-nav-btn:hover {
            background: var(--bg-card-hover);
            border-color: var(--border-hover);
            color: var(--text);
        }

        .calendar-month-title {
            font-size: clamp(14px, 3vw, 16px);
            font-weight: 600;
            min-width: 120px;
            text-align: center;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            width: 100%;
        }

        .calendar-weekday {
            text-align: center;
            font-size: clamp(9px, 2vw, 11px);
            font-weight: 600;
            color: var(--text-tertiary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 8px 0;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            min-height: 36px;
            max-height: 60px;
            padding: 4px;
        }

        .calendar-day:hover {
            background: var(--bg-card-hover);
        }

        .calendar-day.empty {
            cursor: default;
        }

        .calendar-day.empty:hover {
            background: transparent;
        }

        .calendar-day.today {
            position: relative;
        }
        .calendar-day.today .calendar-day-num {
            font-weight: 700;
            color: var(--text);
        }
        .calendar-day.today::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 28px;
            height: 28px;
            border: 2px solid var(--text);
            border-radius: 50%;
            opacity: 0.6;
        }

        .calendar-day.selected {
            background: var(--accent);
        }

        .calendar-day.selected .calendar-day-num {
            color: white;
        }

        .calendar-day-num {
            font-size: clamp(11px, 2.5vw, 14px);
            font-weight: 500;
            color: var(--text-secondary);
        }

        .calendar-day.has-entries .calendar-day-num {
            color: var(--text);
            font-weight: 600;
        }

        .calendar-day-dots {
            display: flex;
            gap: 2px;
            margin-top: 2px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 100%;
        }

        .calendar-day-dot {
            width: clamp(4px, 1vw, 6px);
            height: clamp(4px, 1vw, 6px);
            border-radius: 50%;
            flex-shrink: 0;
        }

        .calendar-legend {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 16px;
            padding-top: 12px;
            border-top: 1px solid var(--border);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: clamp(10px, 2vw, 12px);
            color: var(--text-secondary);
        }

        .legend-dot {
            width: clamp(6px, 1.5vw, 8px);
            height: clamp(6px, 1.5vw, 8px);
            border-radius: 50%;
            flex-shrink: 0;
        }

        /* Slim Expandable Cards */
        .entries-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .entry-card-slim {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            overflow: hidden;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .entry-card-slim:hover {
            border-color: var(--border-hover);
        }

        .entry-card-slim.expanded {
            border-color: var(--border-hover);
        }

        .entry-card-slim.accolade {
            border-color: var(--gold-glow);
        }

        .entry-card-slim-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 14px;
        }

        .entry-card-slim-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .entry-card-slim-content {
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .entry-card-slim-title {
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .entry-card-slim-title.gold {
            background: linear-gradient(90deg, var(--gold) 0%, #FFEA00 50%, var(--gold) 100%);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .entry-card-slim-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .entry-card-slim-date {
            font-size: 12px;
            color: var(--text-tertiary);
        }

        .entry-card-slim-cat {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.03em;
            color: var(--text-secondary);
            background: var(--bg-card-hover);
            padding: 3px 8px;
            border-radius: 4px;
        }

        .entry-card-slim-chevron {
            color: var(--text-tertiary);
            transition: transform 0.2s ease;
            flex-shrink: 0;
        }

        .entry-card-slim.expanded .entry-card-slim-chevron {
            transform: rotate(180deg);
        }

        .entry-card-slim-details {
            display: none;
            padding: 0 14px 14px 36px;
            border-top: 1px solid var(--border);
        }

        .entry-card-slim.expanded .entry-card-slim-details {
            display: block;
        }

        .entry-card-slim-person {
            font-size: 13px;
            color: var(--text-secondary);
            margin-top: 12px;
            margin-bottom: 8px;
        }

        .entry-card-slim-person.linked {
            color: var(--accent);
        }

        .entry-card-slim-notes {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 12px;
        }

        .entry-card-slim-takeaways {
            background: rgba(94, 92, 230, 0.1);
            border-left: 3px solid #5E5CE6;
            border-radius: 0 6px 6px 0;
            padding: 10px 12px;
            margin-bottom: 12px;
        }

        .entry-card-slim-takeaways-label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #5E5CE6;
            margin-bottom: 4px;
        }

        .entry-card-slim-takeaways-text {
            font-size: 13px;
            color: var(--text);
            line-height: 1.5;
        }

        .entry-card-slim-actions {
            display: flex;
            gap: 8px;
            padding-top: 8px;
        }

        .entry-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 18px 20px;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }

        .entry-card::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            border-radius: 3px 0 0 3px;
        }

        .entry-card:hover {
            background: var(--bg-card-hover);
            transform: translateX(4px);
        }

        .entry-card.accolade {
            border-color: var(--gold-glow);
        }

        .entry-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .entry-date {
            font-size: 13px;
            color: var(--text-tertiary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: #252529;
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 28px;
            width: 90%;
            max-width: 400px;
            transform: translateY(20px) scale(0.97);
            transition: transform 0.2s ease;
        }

        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
        }

        .modal h3 {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 24px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }

        .color-opt {
            aspect-ratio: 1;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.15s ease;
        }

        .color-opt:hover {
            transform: scale(1.1);
        }

        .color-opt.selected {
            border-color: white;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 100px;
            right: 32px;
            background: #2f2f35;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px 18px;
            color: var(--text);
            font-size: 14px;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.25s ease;
            z-index: 101;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        /* Entry Modal - Premium Animation */
        .entry-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(0px);
        }
        .entry-modal-overlay.active {
            opacity: 1;
            visibility: visible;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
        }
        .entry-modal {
            background: linear-gradient(145deg, #2a2a30, #232328);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 20px;
            padding: 32px;
            width: 90%;
            max-width: 480px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.05) inset;
            transform: scale(0.8) translateY(40px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .entry-modal-overlay.active .entry-modal {
            transform: scale(1) translateY(0);
            opacity: 1;
        }
        .entry-modal-overlay.closing {
            opacity: 0;
            background: rgba(0, 0, 0, 0);
            backdrop-filter: blur(0px);
        }
        .entry-modal-overlay.closing .entry-modal {
            transform: scale(0.9) translateY(20px);
            opacity: 0;
        }
        .entry-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
        }
        .entry-modal-title {
            font-size: 22px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }
        .entry-modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: rgba(255,255,255,0.08);
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }
        .entry-modal-close:hover {
            background: rgba(255,255,255,0.15);
            color: var(--text);
            transform: rotate(90deg);
        }
        .entry-modal .form-group {
            margin-bottom: 20px;
        }
        .entry-modal .form-label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 8px;
            display: block;
        }
        .entry-modal .form-input,
        .entry-modal .form-textarea {
            width: 100%;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 14px 16px;
            color: var(--text);
            font-size: 15px;
            transition: all 0.2s ease;
        }
        .entry-modal .form-input:focus,
        .entry-modal .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
            background: rgba(255,255,255,0.08);
            box-shadow: 0 0 0 3px rgba(10,132,255,0.15);
        }
        .entry-modal .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        .entry-modal .category-radios {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .entry-modal .cat-radio-label {
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 13px;
            border: 1px solid transparent;
            cursor: pointer;
            transition: all 0.2s ease;
            background: rgba(255,255,255,0.06);
        }
        .entry-modal .cat-radio-label:hover {
            background: rgba(255,255,255,0.1);
        }
        .entry-modal .cat-radio:checked + .cat-radio-label {
            border-color: currentColor;
            background: rgba(255,255,255,0.12);
        }
        .entry-modal-actions {
            display: flex;
            gap: 12px;
            margin-top: 28px;
        }
        .entry-modal-actions .btn {
            flex: 1;
            padding: 14px 24px;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .entry-modal-actions .btn-primary {
            background: var(--accent);
            color: white;
        }
        .entry-modal-actions .btn-primary:hover {
            background: #0977e5;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(10,132,255,0.3);
        }
        .entry-modal-actions .btn-secondary {
            background: rgba(255,255,255,0.08);
            color: var(--text-secondary);
        }
        .entry-modal-actions .btn-secondary:hover {
            background: rgba(255,255,255,0.12);
            color: var(--text);
        }

        /* Inline Category Customizer */
        .custom-category-box {
            margin-top: 12px;
            padding: 16px;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            display: none;
            animation: slideDown 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .custom-category-box.visible {
            display: block;
        }
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .custom-category-row {
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .custom-category-name {
            flex: 1;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 10px 14px;
            color: var(--text);
            font-size: 14px;
            outline: none;
            transition: all 0.2s ease;
        }
        .custom-category-name:focus {
            border-color: var(--accent);
            background: rgba(255,255,255,0.08);
        }
        .custom-color-picker {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 12px;
        }
        .custom-color-opt {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.15s ease;
            position: relative;
        }
        .custom-color-opt:hover {
            transform: scale(1.15);
        }
        .custom-color-opt.selected {
            border-color: white;
            box-shadow: 0 0 0 2px rgba(0,0,0,0.3);
        }
        .custom-color-opt.selected::after {
            content: '';
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-tertiary);
        }

        .empty-state p {
            margin-bottom: 4px;
        }

        /* ==================== MOBILE STYLES ==================== */

        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            width: 44px;
            height: 44px;
            border: none;
            background: transparent;
            color: var(--text);
            cursor: pointer;
            padding: 10px;
            margin-right: 8px;
            border-radius: var(--radius-sm);
        }

        .mobile-menu-btn:active {
            background: var(--bg-card);
        }

        .mobile-menu-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Mobile back button */
        .mobile-back-btn {
            display: none;
            width: 44px;
            height: 44px;
            border: none;
            background: transparent;
            color: var(--text);
            cursor: pointer;
            padding: 10px;
            margin-right: 4px;
            border-radius: var(--radius-sm);
        }

        .mobile-back-btn:active {
            background: var(--bg-card);
        }

        .mobile-back-btn svg {
            width: 24px;
            height: 24px;
        }

        /* Sidebar overlay for mobile */
        .sidebar-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 199;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        @media (max-width: 1024px) {
            /* Fix mobile viewport height - accounts for browser UI */
            html, body {
                overflow-x: hidden;
                height: 100%;
                height: calc(var(--vh, 1vh) * 100);
                height: 100dvh;
            }

            .app {
                overflow-x: hidden;
                height: 100%;
                height: calc(var(--vh, 1vh) * 100);
                height: 100dvh;
                min-height: 0;
                flex-direction: column; /* Stack vertically on mobile */
            }

            .main {
                flex: 1;
                min-height: 0;
                display: flex;
                flex-direction: column;
            }

            /* Entry cards - ensure text wraps properly */
            .entry-title,
            .entry-card-slim-title {
                word-break: break-word;
                white-space: normal;
            }

            /* Timeline entry text wrapping */
            .timeline-entry {
                word-break: break-word;
            }

            /* Category radios - better mobile wrapping */
            .category-radios {
                gap: 6px;
            }

            .category-radio-label {
                padding: 12px;
                font-size: 13px;
                flex: 1 1 calc(50% - 6px);
                min-width: 0;
                justify-content: center;
            }

            /* Summary breakdown improvements for narrow screens */
            .breakdown-row {
                flex-wrap: wrap;
            }

            .breakdown-label {
                width: 100%;
                margin-bottom: 4px;
            }

            .breakdown-bar {
                width: calc(100% - 50px);
            }

            /* Mobile menu button visible */
            .mobile-menu-btn {
                display: flex !important;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            .mobile-menu-btn svg {
                stroke: #ffffff;
            }

            /* Mobile back button visible when in sub-views */
            .mobile-back-btn.visible {
                display: flex !important;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
            }

            .mobile-back-btn svg {
                stroke: #ffffff;
            }

            /* Hide hamburger when back is shown */
            .mobile-menu-btn.hidden {
                display: none !important;
            }

            /* Sidebar slides in from left */
            .sidebar {
                position: fixed;
                left: 0;
                top: 0;
                bottom: 0;
                width: 280px;
                z-index: 200;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
                background: var(--bg);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .sidebar-overlay {
                display: block;
            }

            .sidebar-overlay.active {
                opacity: 1;
                visibility: visible;
                pointer-events: auto;
            }

            /* Header adjustments */
            .header {
                padding: 12px 16px;
                flex-wrap: wrap;
                gap: 12px;
                flex-shrink: 0; /* Never shrink the header */
                position: relative;
                z-index: 10;
            }

            .header-left {
                flex: 1 1 auto;
                min-width: 0;
                overflow: hidden;
            }

            .header h1 {
                font-size: 18px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                flex-shrink: 1;
                min-width: 0;
            }

            .year-nav {
                margin-left: 8px;
            }

            .year-nav-btn {
                width: 32px;
                height: 32px;
            }

            .year-nav-label {
                font-size: 14px;
            }

            .search-box {
                width: 100%;
                flex: 0 0 100%;
                order: 3;
                padding: 12px 16px;
            }

            .search-box input {
                font-size: 16px; /* Prevents iOS zoom */
            }

            /* Timeline adjustments */
            .timeline-scroll {
                padding: 0 16px 120px 70px;
            }

            .timeline-wrapper {
                padding-left: 50px;
            }

            .timeline-line {
                left: 18px;
            }

            .day-number {
                left: -72px;
                font-size: 12px;
                width: 28px;
                text-align: right;
            }

            .day-row.expanded .day-number {
                font-size: 22px;
                left: -80px;
            }

            .notch {
                left: -36px;
            }

            .day-row.has-entries .notch {
                left: -37px;
            }

            .connector {
                left: -24px;
                width: 24px;
            }

            .timeline-entry {
                padding: 14px;
            }

            .entry-title {
                font-size: 14px;
            }

            .entry-actions {
                opacity: 1;
                margin-top: 12px;
            }

            .entry-btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            /* List container */
            .list-container {
                padding: 0 16px 120px;
            }

            /* People grid */
            .people-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .person-card {
                padding: 20px;
            }

            /* Calendar mobile - improve scaling */
            .entries-calendar {
                padding: 12px;
                margin-bottom: 16px;
            }

            .calendar-header {
                flex-wrap: wrap;
                gap: 8px;
            }

            .calendar-nav {
                width: 100%;
                justify-content: space-between;
            }

            .calendar-month-title {
                font-size: 14px;
                min-width: auto;
                flex: 1;
            }

            .calendar-nav-btn {
                width: 36px;
                height: 36px;
            }

            .calendar-grid {
                gap: 2px;
            }

            .calendar-day {
                min-height: 32px;
                padding: 2px;
            }

            .calendar-day-num {
                font-size: 11px;
            }

            .calendar-day-dot {
                width: 4px;
                height: 4px;
            }

            .calendar-legend {
                gap: 8px;
                justify-content: center;
            }

            .legend-item {
                font-size: 10px;
            }

            /* Slim cards mobile */
            .entry-card-slim-header {
                padding: 14px;
            }

            .entry-card-slim-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }

            .entry-card-slim-meta {
                width: 100%;
                justify-content: flex-start;
            }

            .entry-card-slim-details {
                padding: 0 14px 14px 14px;
            }

            .entry-card-slim-actions {
                flex-direction: row;
            }

            .entry-card-slim-actions .entry-btn {
                flex: 1;
            }

            /* Filter bar mobile */
            .filter-bar {
                overflow-x: auto;
                flex-wrap: nowrap;
                padding-bottom: 8px;
                -webkit-overflow-scrolling: touch;
            }

            .filter-btn {
                flex-shrink: 0;
                padding: 10px 14px;
            }

            /* Form improvements */
            .form-container {
                max-width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 0;
            }

            .form-input, .form-select, .form-textarea {
                font-size: 16px; /* Prevents iOS zoom */
                padding: 14px 16px;
            }

            .form-select {
                padding-right: 40px;
            }

            .form-label {
                font-size: 13px;
                margin-bottom: 10px;
            }

            .form-group {
                margin-bottom: 20px;
            }

            .form-actions {
                flex-direction: column;
                gap: 12px;
                margin-top: 24px;
            }

            .btn {
                padding: 14px 20px;
                font-size: 16px;
                width: 100%;
                text-align: center;
            }

            /* FAB adjustments */
            .fab {
                bottom: 24px;
                right: 24px;
                width: 60px;
                height: 60px;
                font-size: 32px;
            }

            /* Modal adjustments */
            .modal {
                width: 95%;
                max-width: 100%;
                margin: 16px;
                padding: 24px 20px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal h3 {
                font-size: 18px;
            }

            /* Filter bar */
            .filter-bar {
                overflow-x: auto;
                padding-bottom: 8px;
                margin-bottom: 16px;
                -webkit-overflow-scrolling: touch;
            }

            .filter-btn {
                padding: 10px 16px;
                font-size: 14px;
                white-space: nowrap;
            }

            /* Entry cards */
            .entry-card {
                padding: 16px;
            }

            .entry-card .entry-actions {
                flex-direction: row;
                gap: 8px;
            }

            .entry-card .entry-btn {
                flex: 1;
                text-align: center;
            }

            /* Detail view */
            .detail-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
                padding: 20px 0;
            }

            .detail-avatar {
                width: 60px;
                height: 60px;
                font-size: 22px;
            }

            .detail-info h2 {
                font-size: 20px;
            }

            .detail-actions {
                flex-direction: column;
                width: 100%;
                gap: 10px;
            }

            .detail-actions .btn {
                width: 100%;
            }

            /* Back link - hide on mobile (use header back button instead) */
            .back-link {
                display: none;
            }

            /* Category items */
            .category-list {
                max-width: 100%;
            }

            .category-item {
                padding: 16px;
            }

            .category-name-input {
                font-size: 16px;
            }

            .category-delete {
                width: 44px;
                height: 44px;
            }

            /* Summary */
            .summary-grid {
                grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
                gap: 12px;
            }

            .stat-card {
                padding: 16px;
            }

            .stat-value {
                font-size: 28px;
            }

            /* Toast adjustments */
            .toast {
                bottom: 100px;
                right: 16px;
                left: 16px;
                text-align: center;
            }

            /* Nav items larger touch targets */
            .nav-item {
                padding: 14px 16px;
                font-size: 15px;
            }

            /* Color picker grid */
            .color-grid {
                gap: 12px;
            }

            .color-opt {
                border-radius: 10px;
            }

            /* Data buttons in sidebar */
            .data-actions {
                padding: 12px 16px;
            }

            .data-btn {
                padding: 12px;
                font-size: 13px;
            }

            /* Coaching notes intro */
            .section-intro {
                font-size: 13px;
                margin-bottom: 20px;
            }

            /* Takeaways */
            .entry-takeaways {
                padding: 12px;
                font-size: 13px;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            .header {
                padding: 10px 12px;
                gap: 8px;
            }

            .header-left {
                min-width: 0;
                flex: 1 1 auto;
                overflow: hidden;
            }

            .header h1 {
                font-size: 16px;
                flex-shrink: 1;
                min-width: 0;
            }

            .mobile-menu-btn,
            .mobile-back-btn {
                width: 40px;
                height: 40px;
                padding: 8px;
                margin-right: 4px;
                flex-shrink: 0;
            }

            .year-nav {
                margin-left: 4px;
                gap: 4px;
                flex-shrink: 0;
            }

            .year-nav-btn {
                width: 28px;
                height: 28px;
            }

            .year-nav-label {
                font-size: 13px;
                min-width: 40px;
            }

            .timeline-scroll {
                padding-left: 55px;
            }

            .timeline-wrapper {
                padding-left: 30px;
            }

            .day-number {
                left: -68px;
                font-size: 11px;
                width: 28px;
            }

            .day-row.expanded .day-number {
                font-size: 18px;
                left: -74px;
            }

            .notch {
                left: -22px;
                width: 8px;
                height: 8px;
            }

            .day-row.has-entries .notch {
                left: -23px;
                width: 10px;
                height: 10px;
            }

            .connector {
                left: -12px;
                width: 12px;
            }

            /* Calendar extra small screens */
            .entries-calendar {
                padding: 10px;
            }

            .calendar-day {
                min-height: 28px;
                border-radius: 6px;
            }

            .calendar-day-num {
                font-size: 10px;
            }

            .calendar-day-dots {
                gap: 1px;
            }

            .calendar-day-dot {
                width: 3px;
                height: 3px;
            }

            .calendar-weekday {
                font-size: 8px;
                padding: 4px 0;
            }

            /* Category radios - full width on extra small */
            .category-radio-label {
                flex: 1 1 100%;
            }

            /* Stats grid - 2 columns on extra small */
            .summary-grid {
                grid-template-columns: 1fr 1fr;
            }

            .stat-card {
                padding: 12px;
            }

            .stat-value {
                font-size: 24px;
            }

            /* Person detail avatar */
            .detail-avatar {
                width: 48px;
                height: 48px;
                font-size: 18px;
            }
        }

        /* Very small screens (320-360px) */
        @media (max-width: 360px) {
            .header {
                padding: 8px 10px;
            }

            .header-left {
                gap: 8px;
            }

            .header h1 {
                font-size: 14px;
            }

            .mobile-menu-btn,
            .mobile-back-btn {
                width: 36px;
                height: 36px;
                padding: 6px;
                margin-right: 2px;
            }

            .year-nav-btn {
                width: 24px;
                height: 24px;
            }

            .year-nav-label {
                font-size: 12px;
                min-width: 36px;
            }

            /* Timeline adjustments for very small screens */
            .timeline-scroll {
                padding-left: 50px;
            }

            .timeline-wrapper {
                padding-left: 26px;
            }

            .day-number {
                left: -62px;
            }

            .day-row.expanded .day-number {
                left: -68px;
            }
        }

        /* ===== Tutorial/Onboarding System ===== */
        .tutorial-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
        }
        .tutorial-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .tutorial-spotlight {
            position: fixed;
            z-index: 9999;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.85);
            border-radius: 12px;
            pointer-events: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: none;
        }

        /* Elevate target elements during tutorial */
        .tutorial-target {
            z-index: 10000 !important;
        }
        /* Keep fixed elements fixed */
        .fab.tutorial-target {
            position: fixed !important;
        }
        /* Inner highlight for focused elements within a larger highlight */
        .tutorial-inner-highlight {
            position: relative;
            animation: tutorial-inner-pulse 1.5s ease-in-out infinite;
            border-radius: 8px;
            box-shadow: 0 0 0 3px var(--accent), 0 0 20px rgba(10, 132, 255, 0.3);
        }
        @keyframes tutorial-inner-pulse {
            0%, 100% { box-shadow: 0 0 0 3px var(--accent), 0 0 20px rgba(10, 132, 255, 0.3); }
            50% { box-shadow: 0 0 0 4px var(--accent), 0 0 30px rgba(10, 132, 255, 0.5); }
        }
        .tutorial-spotlight::after {
            content: '';
            position: absolute;
            inset: -4px;
            border: 2px solid var(--accent);
            border-radius: 14px;
            animation: tutorial-pulse 2s ease-in-out infinite;
        }
        @keyframes tutorial-pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.02); }
        }

        .tutorial-card {
            position: fixed;
            z-index: 10000;
            background: linear-gradient(145deg, #2a2a30, #232328);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 16px;
            padding: 24px;
            max-width: 340px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: translateY(10px);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .tutorial-card.active {
            transform: translateY(0);
            opacity: 1;
            visibility: visible;
        }
        .tutorial-card.center {
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
        }
        .tutorial-card.center.active {
            transform: translate(-50%, -50%);
        }

        .tutorial-step-indicator {
            display: flex;
            gap: 6px;
            margin-bottom: 16px;
        }
        .tutorial-step-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.2s ease;
        }
        .tutorial-step-dot.active {
            background: var(--accent);
            width: 20px;
            border-radius: 4px;
        }
        .tutorial-step-dot.completed {
            background: var(--accent);
        }

        .tutorial-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
        }
        .tutorial-text {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        .tutorial-text strong {
            color: var(--text);
        }

        .tutorial-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        .tutorial-btn {
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
        }
        .tutorial-btn-secondary {
            background: transparent;
            color: var(--text-tertiary);
        }
        .tutorial-btn-secondary:hover {
            color: var(--text);
        }
        .tutorial-btn-primary {
            background: var(--accent);
            color: white;
        }
        .tutorial-btn-primary:hover {
            filter: brightness(1.1);
        }

        /* Initial onboarding modal */
        .onboarding-modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            backdrop-filter: blur(8px);
        }
        .onboarding-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .onboarding-modal {
            background: linear-gradient(145deg, #2a2a30, #232328);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 20px;
            padding: 32px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 25px 80px rgba(0,0,0,0.5);
            transform: scale(0.9);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .onboarding-modal-overlay.active .onboarding-modal {
            transform: scale(1);
            opacity: 1;
        }
        .onboarding-icon {
            font-size: 48px;
            margin-bottom: 20px;
        }
        .onboarding-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
        }
        .onboarding-text {
            font-size: 15px;
            color: var(--text-secondary);
            margin-bottom: 28px;
            line-height: 1.5;
        }
        .onboarding-actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .onboarding-btn {
            padding: 14px 24px;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border: none;
        }
        .onboarding-btn-primary {
            background: var(--accent);
            color: white;
        }
        .onboarding-btn-primary:hover {
            filter: brightness(1.1);
        }
        .onboarding-btn-secondary {
            background: transparent;
            color: var(--text-tertiary);
            border: 1px solid var(--border);
        }
        .onboarding-btn-secondary:hover {
            border-color: var(--text-tertiary);
            color: var(--text);
        }

        /* Tutorial pointer arrow */
        .tutorial-arrow {
            position: absolute;
            width: 0;
            height: 0;
        }
        .tutorial-arrow.top {
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-bottom: 10px solid #2a2a30;
        }
        .tutorial-arrow.bottom {
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid #2a2a30;
        }
        .tutorial-arrow.left {
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-right: 10px solid #2a2a30;
        }
        .tutorial-arrow.right {
            left: 100%;
            top: 50%;
            transform: translateY(-50%);
            border-top: 10px solid transparent;
            border-bottom: 10px solid transparent;
            border-left: 10px solid #2a2a30;
        }

        /* Mobile tutorial adjustments */
        @media (max-width: 768px) {
            .tutorial-card {
                max-width: 300px;
                padding: 20px;
            }
            .tutorial-title {
                font-size: 16px;
            }
            .tutorial-text {
                font-size: 13px;
            }
            .onboarding-modal {
                padding: 24px;
                max-width: 340px;
            }
            .onboarding-title {
                font-size: 20px;
            }
            .onboarding-text {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- Mobile sidebar overlay -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <span class="logo-progressive">PGR</span> TRACKER
            </div>
            <nav class="nav">
                <div class="nav-item active" data-view="timeline">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="2" x2="12" y2="22"></line>
                        <circle cx="12" cy="6" r="2"></circle>
                        <circle cx="12" cy="12" r="2"></circle>
                        <circle cx="12" cy="18" r="2"></circle>
                    </svg>
                    Timeline
                </div>
                <div class="nav-item" data-view="entries">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"></line>
                        <line x1="8" y1="12" x2="21" y2="12"></line>
                        <line x1="8" y1="18" x2="21" y2="18"></line>
                        <circle cx="4" cy="6" r="1"></circle>
                        <circle cx="4" cy="12" r="1"></circle>
                        <circle cx="4" cy="18" r="1"></circle>
                    </svg>
                    All Entries
                </div>
                <div class="nav-item" data-view="people">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    People
                </div>
                <div class="nav-divider"></div>
                <div class="nav-item" data-view="summary">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 20V10"></path>
                        <path d="M12 20V4"></path>
                        <path d="M6 20v-6"></path>
                    </svg>
                    Summary
                </div>
                <div class="nav-item" data-view="categories">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M12 1v4M12 19v4M4.22 4.22l2.83 2.83M16.95 16.95l2.83 2.83M1 12h4M19 12h4M4.22 19.78l2.83-2.83M16.95 7.05l2.83-2.83"></path>
                    </svg>
                    Categories
                </div>
            </nav>
            <!-- Sidebar Mini Calendar -->
            <div class="sidebar-calendar" id="sidebar-calendar">
                <div class="sidebar-calendar-header">
                    <div class="sidebar-cal-nav">
                        <button class="sidebar-cal-nav-btn" id="sidebar-cal-prev-year" title="Previous Year">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="11 17 6 12 11 7"></polyline><polyline points="18 17 13 12 18 7"></polyline></svg>
                        </button>
                        <button class="sidebar-cal-nav-btn" id="sidebar-cal-prev" title="Previous Month">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"></polyline></svg>
                        </button>
                    </div>
                    <span class="sidebar-calendar-title" id="sidebar-cal-title" title="Click to go to today">January 2025</span>
                    <div class="sidebar-cal-nav">
                        <button class="sidebar-cal-nav-btn" id="sidebar-cal-next" title="Next Month">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"></polyline></svg>
                        </button>
                        <button class="sidebar-cal-nav-btn" id="sidebar-cal-next-year" title="Next Year">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="13 17 18 12 13 7"></polyline><polyline points="6 17 11 12 6 7"></polyline></svg>
                        </button>
                    </div>
                </div>
                <div class="sidebar-calendar-grid" id="sidebar-cal-grid"></div>
            </div>
            <div class="nav-divider"></div>
            <div class="data-actions">
                <div class="settings-container">
                    <div class="settings-dropdown" id="settings-dropdown">
                        <button class="settings-dropdown-item highlight" id="year-review-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                            </svg>
                            Year End Review
                        </button>
                        <div class="settings-dropdown-divider"></div>
                        <button class="settings-dropdown-item" id="export-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Export Data
                        </button>
                        <button class="settings-dropdown-item" id="import-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Import Data
                        </button>
                        <div class="settings-dropdown-divider"></div>
                        <button class="settings-dropdown-item" id="restart-tutorial-btn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                                <path d="M3 3v5h5"></path>
                            </svg>
                            Replay Tutorial
                        </button>
                    </div>
                    <button class="settings-btn" id="settings-btn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                        Settings
                    </button>
                    <input type="file" id="import-file" accept=".json" style="display:none">
                </div>
            </div>
            <div class="nav-footer" id="entry-count">0 entries</div>
        </aside>

        <main class="main">
            <header class="header">
                <div class="header-left">
                    <!-- Mobile back button -->
                    <button class="mobile-back-btn" id="mobile-back-btn" aria-label="Go back">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 12H5M12 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <!-- Mobile hamburger menu -->
                    <button class="mobile-menu-btn" id="mobile-menu-btn" aria-label="Open menu">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="3" y1="6" x2="21" y2="6"></line>
                            <line x1="3" y1="12" x2="21" y2="12"></line>
                            <line x1="3" y1="18" x2="21" y2="18"></line>
                        </svg>
                    </button>
                    <h1 id="view-title">Timeline</h1>
                    <!-- Year navigation for timeline -->
                    <div class="year-nav" id="year-nav">
                        <button class="year-nav-btn" id="year-prev">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M15 18l-6-6 6-6"/></svg>
                        </button>
                        <span class="year-nav-label" id="year-label">2025</span>
                        <button class="year-nav-btn" id="year-next">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M9 18l6-6-6-6"/></svg>
                        </button>
                    </div>
                </div>
                <div class="search-box">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <input type="text" id="search-input" placeholder="Search...">
                </div>
            </header>

            <div class="content">
                <!-- Timeline -->
                <div class="view timeline-view active" id="timeline-view">
                    <div class="timeline-scroll" id="timeline-scroll">
                        <div class="timeline-wrapper" id="timeline-wrapper">
                            <div class="timeline-line"></div>
                            <!-- Timeline content rendered by JS -->
                        </div>
                    </div>
                </div>

                <!-- All Entries -->
                <div class="view" id="entries-view">
                    <div class="list-container">
                        <div class="filter-bar" id="filter-bar"></div>
                        <div class="entries-calendar" id="entries-calendar"></div>
                        <div class="entries-list" id="entries-list"></div>
                    </div>
                </div>

                <!-- People -->
                <div class="view" id="people-view">
                    <div class="list-container">
                        <div class="people-grid" id="people-grid"></div>
                    </div>
                </div>

                <!-- Person Detail -->
                <div class="view" id="person-detail-view">
                    <div class="list-container">
                        <div class="back-link" id="back-to-people">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                                <path d="M19 12H5M12 19l-7-7 7-7"></path>
                            </svg>
                            People
                        </div>
                        <div class="detail-header">
                            <div class="detail-avatar" id="detail-avatar"></div>
                            <div class="detail-info">
                                <h2 id="detail-name"></h2>
                                <p id="detail-role"></p>
                                <div class="detail-actions">
                                    <button class="btn btn-primary" id="add-session-btn">+ Add Session</button>
                                    <button class="btn btn-secondary" id="edit-person-btn">Edit</button>
                                    <button class="btn btn-secondary delete" id="delete-person-btn">Delete</button>
                                </div>
                            </div>
                        </div>
                        <div class="entries-list" id="person-entries"></div>
                    </div>
                </div>

                <!-- Add/Edit Entry -->
                <div class="view" id="add-view">
                    <div class="list-container">
                        <div class="form-container">
                            <form id="entry-form">
                                <div class="form-group">
                                    <label class="form-label">Category</label>
                                    <div class="category-radios" id="category-radios"></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-input" id="entry-date" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Title</label>
                                    <input type="text" class="form-input" id="entry-title" placeholder="What did you do?" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">With (optional)</label>
                                    <input type="text" class="form-input" id="entry-person" list="people-list" placeholder="Type a name..." autocomplete="off">
                                    <datalist id="people-list"></datalist>
                                </div>
                                <div class="form-group" id="takeaways-group" style="display:none;">
                                    <label class="form-label">Key Takeaways</label>
                                    <textarea class="form-textarea takeaways-field" id="entry-takeaways" placeholder="What did you learn? What will you work on?"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-textarea" id="entry-notes" placeholder="Session details, discussion points..."></textarea>
                                </div>
                                <input type="hidden" id="entry-id">
                                <div class="form-actions">
                                    <button type="submit" class="btn btn-primary">Save Entry</button>
                                    <button type="button" class="btn btn-secondary" id="cancel-entry">Cancel</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Summary -->
                <div class="view" id="summary-view">
                    <div class="list-container">
                        <div class="summary-grid" id="summary-grid"></div>
                        <div class="breakdown-section">
                            <h3>By Category</h3>
                            <div id="breakdown-list"></div>
                        </div>
                    </div>
                </div>

                <!-- Categories -->
                <div class="view" id="categories-view">
                    <div class="list-container">
                        <p style="color: var(--text-secondary); margin-bottom: 20px;">Click a color to change it. Edit names inline.</p>
                        <div class="category-list" id="category-list"></div>
                        <button class="add-category-btn" id="add-category-btn">+ Add Category</button>
                    </div>
                </div>
            </div>

            <!-- Floating Add Button -->
            <button class="fab" id="fab" title="Add Entry">+</button>

            <!-- Today Anchor Button -->
            <button class="today-anchor" id="today-anchor"> Today</button>

            <!-- Context Menu -->
            <div class="context-menu" id="context-menu">
                <div class="context-menu-item" data-action="edit">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    Edit
                </div>
                <div class="context-menu-item" data-action="duplicate">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
                    Duplicate
                </div>
                <div class="context-menu-item" data-action="copy">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
                    Copy as Text
                </div>
                <div class="context-menu-divider"></div>
                <div class="context-menu-item danger" data-action="delete">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    Delete
                </div>
            </div>
        </main>
    </div>

    <!-- Person Modal -->
    <div class="modal-overlay" id="person-modal">
        <div class="modal">
            <h3 id="person-modal-title">Add Person</h3>
            <form id="person-form">
                <div class="form-group">
                    <label class="form-label">Name</label>
                    <input type="text" class="form-input" id="person-name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-select" id="person-role" required>
                        <option value="">Select...</option>
                        <option value="mentee">Mentee</option>
                        <option value="coachee">Coachee</option>
                        <option value="peer">Peer</option>
                        <option value="manager">Manager</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="person-notes" placeholder="Optional notes..."></textarea>
                </div>
                <input type="hidden" id="person-id">
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" id="cancel-person">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Color Picker Modal -->
    <div class="modal-overlay" id="color-modal">
        <div class="modal">
            <h3>Pick Color</h3>
            <div class="color-grid" id="color-grid"></div>
            <div class="form-actions">
                <button class="btn btn-primary" id="save-color">Save</button>
                <button class="btn btn-secondary" id="cancel-color">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Entry Modal (Premium Popup) -->
    <div class="entry-modal-overlay" id="entry-modal">
        <div class="entry-modal">
            <div class="entry-modal-header">
                <h2 class="entry-modal-title" id="entry-modal-title">Add Entry</h2>
                <button class="entry-modal-close" id="entry-modal-close">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <form id="entry-modal-form">
                <div class="form-group">
                    <label class="form-label">Category</label>
                    <div class="category-radios" id="modal-category-radios"></div>
                    <div class="custom-category-box" id="custom-category-box">
                        <div class="custom-category-row">
                            <input type="text" class="custom-category-name" id="custom-category-name" value="Other" placeholder="Category name...">
                        </div>
                        <div class="custom-color-picker" id="custom-color-picker"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Date</label>
                    <input type="date" class="form-input" id="modal-entry-date" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Title</label>
                    <input type="text" class="form-input" id="modal-entry-title" placeholder="What did you do?" required>
                </div>
                <div class="form-group">
                    <label class="form-label">With (optional)</label>
                    <input type="text" class="form-input" id="modal-entry-person" list="modal-people-list" placeholder="Type a name..." autocomplete="off">
                    <datalist id="modal-people-list"></datalist>
                </div>
                <div class="form-group" id="modal-takeaways-group" style="display:none;">
                    <label class="form-label">Key Takeaways</label>
                    <textarea class="form-textarea" id="modal-entry-takeaways" placeholder="What did you learn? What will you work on?"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-textarea" id="modal-entry-notes" placeholder="Session details, discussion points..."></textarea>
                </div>
                <input type="hidden" id="modal-entry-id">
                <div class="entry-modal-actions">
                    <button type="button" class="btn btn-secondary" id="modal-cancel-entry">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Entry</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Onboarding Modal -->
    <div class="onboarding-modal-overlay" id="onboarding-modal">
        <div class="onboarding-modal">
            <div class="onboarding-icon"></div>
            <h2 class="onboarding-title">Need help navigating?</h2>
            <p class="onboarding-text">Take a quick tour to learn how to track your achievements and make the most of PGR Tracker.</p>
            <div class="onboarding-actions">
                <button class="onboarding-btn onboarding-btn-primary" id="start-tutorial-btn">Start Short Tutorial</button>
                <button class="onboarding-btn onboarding-btn-secondary" id="skip-tutorial-btn">Skip Tutorial</button>
            </div>
        </div>
    </div>

    <!-- Tutorial Spotlight -->
    <div class="tutorial-spotlight" id="tutorial-spotlight"></div>

    <!-- Tutorial Card -->
    <div class="tutorial-card" id="tutorial-card">
        <div class="tutorial-step-indicator" id="tutorial-steps"></div>
        <h3 class="tutorial-title" id="tutorial-title"></h3>
        <p class="tutorial-text" id="tutorial-text"></p>
        <div class="tutorial-actions">
            <button class="tutorial-btn tutorial-btn-secondary" id="tutorial-stop">Stop Tutorial</button>
            <button class="tutorial-btn tutorial-btn-primary" id="tutorial-next">Next</button>
        </div>
        <div class="tutorial-arrow" id="tutorial-arrow"></div>
    </div>

    <script>
        const COLORS = [
            '#0A84FF', '#5E5CE6', '#BF5AF2', '#FF375F', '#FF9F0A', '#FFD60A',
            '#30D158', '#64D2FF', '#FF6482', '#AC8E68', '#8E8E93', '#48484A'
        ];

        const DEFAULT_CATS = [
            { id: 'coaching', name: 'Coaching', color: '#5E5CE6', isAccolade: false },
            { id: 'presentation', name: 'Led Presentation/Huddle', color: '#0A84FF', isAccolade: false },
            { id: 'mentoring', name: 'Peer Mentoring', color: '#30D158', isAccolade: false },
            { id: 'accolades', name: 'Accolades', color: '#FFD60A', isAccolade: true }
        ];

        const Store = {
            get: k => { const d = localStorage.getItem('pp_' + k); return d ? JSON.parse(d) : null; },
            set: (k, v) => localStorage.setItem('pp_' + k, JSON.stringify(v))
        };

        let entries = Store.get('entries') || [];
        let people = Store.get('people') || [];
        let categories = Store.get('categories') || DEFAULT_CATS;

        // Migration: Add Peer Mentoring category if missing
        if (!categories.find(c => c.id === 'mentoring')) {
            const accoladesIdx = categories.findIndex(c => c.id === 'accolades');
            const newCat = { id: 'mentoring', name: 'Peer Mentoring', color: '#30D158', isAccolade: false };
            if (accoladesIdx >= 0) {
                categories.splice(accoladesIdx, 0, newCat);
            } else {
                categories.push(newCat);
            }
            Store.set('categories', categories);
        }

        // First run: add welcome entry
        if (entries.length === 0) {
            const today = new Date().toISOString().split('T')[0];
            entries.push({
                id: 'welcome',
                date: today,
                categoryId: 'other',
                title: 'Thanks for using PGR Tracker!',
                personId: null,
                personName: null,
                takeaways: null,
                notes: "This tool is designed to help keep track of coachings, events, presentations and more throughout your work year! Easily navigate and search to find what you've done!",
                createdAt: Date.now(),
                updatedAt: Date.now()
            });
            Store.set('entries', entries);
        }
        let currentYear = new Date().getFullYear();
        let selectedPersonId = null;
        let editingEntryId = null;
        let editingCatId = null;
        let searchQuery = '';
        let currentFilter = 'all';
        let calendarMonth = new Date().getMonth(); // 0-11
        let calendarYear = new Date().getFullYear();
        let selectedCalendarDate = null;

        // Sidebar mini calendar state
        let sidebarCalMonth = new Date().getMonth();
        let sidebarCalYear = new Date().getFullYear();
        let timelineScrollObserver = null;

        // Navigation history for mobile back button
        let navHistory = ['timeline'];
        let currentView = 'timeline';

        const $ = s => document.querySelector(s);
        const $$ = s => document.querySelectorAll(s);
        const isMobile = () => window.innerWidth <= 1024;
        // Get local date string in YYYY-MM-DD format (fixes timezone issues with valueAsDate)
        const getLocalDateString = (date = new Date()) => {
            return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
        };
        // Parse date string as local time (not UTC) to avoid timezone shift issues
        const parseLocalDate = (dateStr) => new Date(dateStr + 'T00:00:00');

        // Smart search: matches entries by category, month, date, or text
        const MONTH_MAP = {
            'jan': 0, 'january': 0,
            'feb': 1, 'february': 1,
            'mar': 2, 'march': 2,
            'apr': 3, 'april': 3,
            'may': 4,
            'jun': 5, 'june': 5,
            'jul': 6, 'july': 6,
            'aug': 7, 'august': 7,
            'sep': 8, 'sept': 8, 'september': 8,
            'oct': 9, 'october': 9,
            'nov': 10, 'november': 10,
            'dec': 11, 'december': 11
        };

        function smartSearchMatch(entry, query) {
            if (!query) return true;
            const q = query.toLowerCase().trim();

            // Get entry details
            const cat = categories.find(c => c.id === entry.categoryId);
            const catName = cat?.name?.toLowerCase() || '';
            const catId = entry.categoryId?.toLowerCase() || '';
            const entryDate = parseLocalDate(entry.date);
            const entryMonth = entryDate.getMonth();
            const entryDay = entryDate.getDate();

            // Check category match (partial match: "coach" matches "coaching", "acc" matches "accolades")
            if (catName.includes(q) || catId.includes(q)) return true;

            // Check month match (e.g., "jan", "january")
            const monthNum = MONTH_MAP[q];
            if (monthNum !== undefined && entryMonth === monthNum) return true;

            // Check for partial month match (e.g., "janu" matches january entries)
            for (const [monthName, monthIdx] of Object.entries(MONTH_MAP)) {
                if (monthName.startsWith(q) && entryMonth === monthIdx) return true;
            }

            // Check day number match (e.g., "15" shows all entries on the 15th of any month)
            const dayMatch = q.match(/^(\d{1,2})$/);
            if (dayMatch && parseInt(dayMatch[1]) === entryDay) return true;

            // Check month + day pattern (e.g., "jan 15", "january 15")
            const monthDayMatch = q.match(/^([a-z]+)\s*(\d{1,2})$/);
            if (monthDayMatch) {
                const m = MONTH_MAP[monthDayMatch[1]];
                const d = parseInt(monthDayMatch[2]);
                if (m !== undefined && entryMonth === m && entryDay === d) return true;
            }

            // Check date format (e.g., "1/15", "01/15")
            const slashDate = q.match(/^(\d{1,2})\/(\d{1,2})$/);
            if (slashDate) {
                const m = parseInt(slashDate[1]) - 1;
                const d = parseInt(slashDate[2]);
                if (entryMonth === m && entryDay === d) return true;
            }

            // Fall back to standard text search on title and notes
            const text = `${entry.title} ${entry.notes || ''}`.toLowerCase();
            return text.includes(q);
        }

        function init() {
            // Fix mobile viewport height (address bar issue)
            fixMobileViewportHeight();

            setupNav();
            setupMobile();
            setupYear();
            setupSearch();
            setupForms();
            setupColorPicker();
            setupEntryModal();
            setupContextMenu();
            // Initialize sidebar calendar to current month/year
            sidebarCalMonth = new Date().getMonth();
            sidebarCalYear = currentYear;
            render();
            setupTodayAnchor();
            updateMobileButtons();
            // Show year nav on timeline (initial view)
            $('#year-nav').classList.add('visible');
            updateYearNav();

            // Initialize tutorial system
            TutorialSystem.init();
        }

        // Fix for mobile browsers where 100vh includes the address bar
        function fixMobileViewportHeight() {
            const setVh = () => {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            };
            setVh();
            window.addEventListener('resize', setVh);
            window.addEventListener('orientationchange', () => {
                setTimeout(setVh, 100);
            });
        }

        function setupContextMenu() {
            // Context menu action handlers
            $$('.context-menu-item').forEach(item => {
                item.addEventListener('click', () => {
                    if (!contextMenuEntryId) return;
                    const action = item.dataset.action;
                    switch(action) {
                        case 'edit':
                            editEntry(contextMenuEntryId);
                            break;
                        case 'duplicate':
                            duplicateEntry(contextMenuEntryId);
                            break;
                        case 'copy':
                            copyEntryAsText(contextMenuEntryId);
                            break;
                        case 'delete':
                            deleteEntry(contextMenuEntryId);
                            break;
                    }
                    hideContextMenu();
                });
            });

            // Hide context menu on click outside
            document.addEventListener('click', e => {
                if (!e.target.closest('.context-menu')) {
                    hideContextMenu();
                }
            });

            // Hide context menu on escape
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape') {
                    hideContextMenu();
                }
            });

            // Hide context menu on scroll
            document.addEventListener('scroll', hideContextMenu, true);
        }

        function setupMobile() {
            // Hamburger menu toggle
            $('#mobile-menu-btn').addEventListener('click', () => {
                $('#sidebar').classList.add('open');
                $('#sidebar-overlay').classList.add('active');
            });

            // Close sidebar on overlay click
            $('#sidebar-overlay').addEventListener('click', closeSidebar);

            // Mobile back button
            $('#mobile-back-btn').addEventListener('click', goBack);

            // Handle browser back button
            window.addEventListener('popstate', (e) => {
                if (e.state && e.state.view) {
                    // Restore view without adding to history
                    switchView(e.state.view, false);
                }
            });

            // Push initial state
            history.replaceState({ view: 'timeline' }, '', '');
        }

        function closeSidebar() {
            $('#sidebar').classList.remove('open');
            $('#sidebar-overlay').classList.remove('active');
        }

        function goBack() {
            // Remove current view from history
            if (navHistory.length > 1) {
                navHistory.pop();
                const prevView = navHistory[navHistory.length - 1];
                switchView(prevView, false); // Don't add to history
            }
        }

        function updateMobileButtons() {
            const mainViews = ['timeline', 'entries', 'people', 'coaching', 'summary', 'categories'];
            const isMainView = mainViews.includes(currentView);

            // Show back button for sub-views, hamburger for main views
            if (isMainView) {
                $('#mobile-back-btn').classList.remove('visible');
                $('#mobile-menu-btn').classList.remove('hidden');
            } else {
                $('#mobile-back-btn').classList.add('visible');
                $('#mobile-menu-btn').classList.add('hidden');
            }
        }

        function setupNav() {
            $$('.nav-item').forEach(n => n.addEventListener('click', () => switchView(n.dataset.view)));
            $('#back-to-people').addEventListener('click', () => {
                // Use goBack on mobile, direct nav on desktop
                if (isMobile() && navHistory.length > 1) {
                    goBack();
                } else {
                    switchView('people');
                }
            });
            $('#fab').addEventListener('click', () => {
                openEntryModal();
            });

            // Year navigation
            $('#year-prev').addEventListener('click', () => {
                currentYear--;
                sidebarCalYear = currentYear;
                updateYearNav();
                render();
            });
            $('#year-next').addEventListener('click', () => {
                currentYear++;
                sidebarCalYear = currentYear;
                updateYearNav();
                render();
            });

            // Sidebar calendar navigation
            $('#sidebar-cal-prev').addEventListener('click', () => {
                sidebarCalMonth--;
                if (sidebarCalMonth < 0) {
                    sidebarCalMonth = 11;
                    sidebarCalYear--;
                }
                renderSidebarCalendar();
            });
            $('#sidebar-cal-next').addEventListener('click', () => {
                sidebarCalMonth++;
                if (sidebarCalMonth > 11) {
                    sidebarCalMonth = 0;
                    sidebarCalYear++;
                }
                renderSidebarCalendar();
            });
            $('#sidebar-cal-prev-year').addEventListener('click', () => {
                sidebarCalYear--;
                renderSidebarCalendar();
            });
            $('#sidebar-cal-next-year').addEventListener('click', () => {
                sidebarCalYear++;
                renderSidebarCalendar();
            });
            $('#sidebar-cal-title').addEventListener('click', () => {
                // Jump to current month/year
                sidebarCalMonth = new Date().getMonth();
                sidebarCalYear = new Date().getFullYear();
                renderSidebarCalendar();
            });
        }

        function updateYearNav() {
            $('#year-label').textContent = currentYear;
        }

        function switchView(v, addToHistory = true) {
            $$('.nav-item').forEach(n => n.classList.toggle('active', n.dataset.view === v));
            $$('.view').forEach(el => el.classList.remove('active'));
            $(`#${v}-view`).classList.add('active');

            const titles = { timeline: 'Timeline', entries: 'All Entries', people: 'People', add: 'Add Entry', summary: 'Summary', categories: 'Categories', 'person-detail': 'Person' };
            $('#view-title').textContent = titles[v] || v;

            // Show year nav only on timeline
            if (v === 'timeline') {
                $('#year-nav').classList.add('visible');
                updateYearNav();
            } else {
                $('#year-nav').classList.remove('visible');
            }

            // Update current view
            currentView = v;

            // Add to navigation history if needed
            if (addToHistory && navHistory[navHistory.length - 1] !== v) {
                navHistory.push(v);
                // Also push to browser history for mobile back button
                history.pushState({ view: v }, '', '');
            }

            // Update mobile buttons
            updateMobileButtons();

            // Close sidebar on mobile when navigating
            if (isMobile()) {
                closeSidebar();
            }

            if (v === 'add') updateFormSelects();
            if (v === 'summary') renderSummary();
            if (v === 'categories') renderCategories();
            if (v === 'entries') renderEntries();
        }

        function setupYear() {
            // Set default year - next year if December, otherwise current year
            const thisYear = new Date().getFullYear();
            const nextYear = thisYear + 1;
            currentYear = new Date().getMonth() === 11 ? nextYear : thisYear;
            calendarYear = currentYear;
        }

        function setupSearch() {
            $('#search-input').addEventListener('input', e => {
                searchQuery = e.target.value.toLowerCase();
                render();
            });
        }

        function setupForms() {
            $('#entry-form').addEventListener('submit', e => { e.preventDefault(); saveEntry(); });
            $('#cancel-entry').addEventListener('click', () => {
                // Go back to previous view instead of always timeline
                if (navHistory.length > 1) {
                    goBack();
                } else {
                    switchView('timeline');
                }
            });
            $('#entry-date').value = getLocalDateString();

            $('#person-form').addEventListener('submit', e => { e.preventDefault(); savePerson(); });
            $('#cancel-person').addEventListener('click', () => closeModal('person-modal'));
            $('#person-modal').addEventListener('click', e => { if (e.target.id === 'person-modal') closeModal('person-modal'); });

            $('#edit-person-btn').addEventListener('click', () => {
                const p = people.find(x => x.id === selectedPersonId);
                if (p) openPersonModal(p);
            });
            $('#add-session-btn').addEventListener('click', () => {
                clearEntryForm();
                updateFormSelects();
                const person = people.find(p => p.id === selectedPersonId);
                $('#entry-person').value = person ? person.name : '';
                switchView('add');
            });
            $('#delete-person-btn').addEventListener('click', () => {
                if (confirm('Delete this person?')) {
                    people = people.filter(p => p.id !== selectedPersonId);
                    Store.set('people', people);
                    toast('Person deleted');
                    switchView('people');
                    render();
                }
            });

            $('#add-category-btn').addEventListener('click', addCategory);

            // Settings dropdown
            $('#settings-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                $('#settings-dropdown').classList.toggle('open');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.settings-container')) {
                    $('#settings-dropdown').classList.remove('open');
                }
            });

            // Export/Import
            $('#export-btn').addEventListener('click', () => {
                $('#settings-dropdown').classList.remove('open');
                exportData();
            });
            $('#import-btn').addEventListener('click', () => {
                $('#settings-dropdown').classList.remove('open');
                $('#import-file').click();
            });
            $('#import-file').addEventListener('change', importData);

            // Year End Review
            $('#year-review-btn').addEventListener('click', () => {
                $('#settings-dropdown').classList.remove('open');
                if (isMobile()) closeSidebar();
                generateYearEndReview();
            });
        }

        function exportData() {
            const data = {
                version: 1,
                exportedAt: new Date().toISOString(),
                entries,
                people,
                categories
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pgr-tracker-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            toast('Data exported');
        }

        function importData(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);

                    if (!data.entries || !data.people || !data.categories) {
                        throw new Error('Invalid backup file');
                    }

                    if (!confirm(`Import ${data.entries.length} entries, ${data.people.length} people, and ${data.categories.length} categories? This will replace your current data.`)) {
                        return;
                    }

                    entries = data.entries;
                    people = data.people;
                    categories = data.categories;

                    Store.set('entries', entries);
                    Store.set('people', people);
                    Store.set('categories', categories);

                    setupYear();
                    render();
                    toast('Data imported successfully');
                } catch (err) {
                    alert('Failed to import: ' + err.message);
                }
            };
            reader.readAsText(file);
            e.target.value = ''; // Reset file input
        }

        function generateYearEndReview() {
            // Get the year to review - prompt user
            const thisYear = new Date().getFullYear();
            const availableYears = [...new Set(entries.map(e => parseLocalDate(e.date).getFullYear()))].sort((a, b) => b - a);

            if (availableYears.length === 0) {
                alert('No entries to review yet!');
                return;
            }

            // Default to most recent year with entries
            const reviewYear = availableYears[0];

            // Filter entries for that year, excluding coaching (internal/developmental)
            const yearEntries = entries
                .filter(e => parseLocalDate(e.date).getFullYear() === reviewYear && e.categoryId !== 'coaching')
                .sort((a, b) => parseLocalDate(a.date) - parseLocalDate(b.date));

            if (yearEntries.length === 0) {
                alert(`No highlights found for ${reviewYear}`);
                return;
            }

            // Group by category
            const accolades = yearEntries.filter(e => e.categoryId === 'accolades');
            const presentations = yearEntries.filter(e => e.categoryId === 'presentation');
            const mentoring = yearEntries.filter(e => e.categoryId === 'mentoring');
            const other = yearEntries.filter(e => !['accolades', 'presentation', 'mentoring'].includes(e.categoryId));

            // Build the review
            const formatDate = (d) => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

            let review = `YEAR IN REVIEW  ${reviewYear}\n`;
            review += `${''.repeat(40)}\n\n`;

            // Quick stats
            review += `OVERVIEW\n`;
            review += `${'-'.repeat(20)}\n`;
            review += ` ${yearEntries.length} accomplishments tracked\n`;
            if (accolades.length) review += ` ${accolades.length} accolade${accolades.length > 1 ? 's' : ''} received\n`;
            if (presentations.length) review += ` ${presentations.length} presentation${presentations.length > 1 ? 's' : ''} led\n`;
            if (mentoring.length) review += ` ${mentoring.length} peer mentoring session${mentoring.length > 1 ? 's' : ''}\n`;
            review += `\n`;

            // Accolades first (most impressive)
            if (accolades.length) {
                review += ` ACCOLADES & RECOGNITION\n`;
                review += `${'-'.repeat(20)}\n`;
                accolades.forEach(e => {
                    const personNote = e.personName || (e.personId ? people.find(p => p.id === e.personId)?.name : null);
                    review += ` ${formatDate(e.date)}  ${e.title}${personNote ? ` (${personNote})` : ''}\n`;
                });
                review += `\n`;
            }

            // Presentations
            if (presentations.length) {
                review += ` PRESENTATIONS & LEADERSHIP\n`;
                review += `${'-'.repeat(20)}\n`;
                presentations.forEach(e => {
                    const personNote = e.personName || (e.personId ? people.find(p => p.id === e.personId)?.name : null);
                    review += ` ${formatDate(e.date)}  ${e.title}${personNote ? ` (with ${personNote})` : ''}\n`;
                });
                review += `\n`;
            }

            // Peer Mentoring
            if (mentoring.length) {
                review += ` PEER MENTORING\n`;
                review += `${'-'.repeat(20)}\n`;
                mentoring.forEach(e => {
                    review += ` ${formatDate(e.date)}  ${e.title}\n`;
                });
                review += `\n`;
            }

            // Other highlights
            if (other.length) {
                review += ` OTHER HIGHLIGHTS\n`;
                review += `${'-'.repeat(20)}\n`;
                other.forEach(e => {
                    const cat = categories.find(c => c.id === e.categoryId);
                    review += ` ${formatDate(e.date)}  ${e.title}${cat ? ` [${cat.name}]` : ''}\n`;
                });
                review += `\n`;
            }

            review += `${''.repeat(40)}\n`;
            review += `Generated ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}\n`;

            // Open in new window for easy copy/print
            const newWindow = window.open('', '_blank', 'width=700,height=800');
            newWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Year In Review - ${reviewYear}</title>
                    <style>
                        body {
                            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
                            background: #1a1a1f;
                            color: #e0e0e0;
                            padding: 40px;
                            line-height: 1.6;
                            font-size: 14px;
                        }
                        pre {
                            white-space: pre-wrap;
                            word-wrap: break-word;
                            margin: 0;
                        }
                        .actions {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            display: flex;
                            gap: 10px;
                        }
                        button {
                            background: #0A84FF;
                            color: white;
                            border: none;
                            padding: 10px 20px;
                            border-radius: 8px;
                            cursor: pointer;
                            font-size: 14px;
                            font-family: inherit;
                        }
                        button:hover {
                            background: #0070E0;
                        }
                        @media print {
                            .actions { display: none; }
                            body { background: white; color: black; }
                        }
                    </style>
                </head>
                <body>
                    <div class="actions">
                        <button onclick="navigator.clipboard.writeText(document.querySelector('pre').textContent).then(() => alert('Copied to clipboard!'))">Copy</button>
                        <button onclick="window.print()">Print</button>
                    </div>
                    <pre>${review}</pre>
                </body>
                </html>
            `);
            newWindow.document.close();
        }

        function setupColorPicker() {
            $('#color-grid').innerHTML = COLORS.map(c => `<div class="color-opt" data-c="${c}" style="background:${c}"></div>`).join('');
            $('#color-grid').addEventListener('click', e => {
                if (e.target.classList.contains('color-opt')) {
                    $$('.color-opt').forEach(o => o.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            });
            $('#save-color').addEventListener('click', () => {
                const sel = $('.color-opt.selected');
                if (sel && editingCatId) {
                    const cat = categories.find(c => c.id === editingCatId);
                    if (cat) { cat.color = sel.dataset.c; Store.set('categories', categories); renderCategories(); render(); toast('Color updated'); }
                }
                closeModal('color-modal');
            });
            $('#cancel-color').addEventListener('click', () => closeModal('color-modal'));
            $('#color-modal').addEventListener('click', e => { if (e.target.id === 'color-modal') closeModal('color-modal'); });
        }

        // Entries
        function saveEntry() {
            const id = $('#entry-id').value || Date.now().toString();
            const personInput = $('#entry-person').value.trim();

            // Try to match person name to existing Person
            const matchedPerson = personInput ? people.find(p => p.name.toLowerCase() === personInput.toLowerCase()) : null;

            const entry = {
                id,
                date: $('#entry-date').value,
                categoryId: getSelectedCategory(),
                title: $('#entry-title').value,
                personId: matchedPerson ? matchedPerson.id : null,
                personName: matchedPerson ? null : (personInput || null),
                takeaways: $('#entry-takeaways').value || null,
                notes: $('#entry-notes').value,
                createdAt: editingEntryId ? entries.find(e => e.id === editingEntryId)?.createdAt : Date.now(),
                updatedAt: Date.now()
            };
            if (editingEntryId) {
                entries[entries.findIndex(e => e.id === editingEntryId)] = entry;
                toast('Entry updated');
            } else {
                entries.push(entry);
                toast('Entry saved');
            }
            Store.set('entries', entries);
            clearEntryForm();
            // Switch to the year of the saved entry instead of resetting
            const savedDate = parseLocalDate(entry.date);
            const savedYear = savedDate.getFullYear();
            currentYear = savedYear;
            calendarYear = savedYear;
            sidebarCalYear = savedYear;
            sidebarCalMonth = savedDate.getMonth();
            updateYearNav();
            render();

            // Go back to previous view (if editing from entries view, go back there)
            if (navHistory.length > 1) {
                // Pop 'add' from history and go back
                navHistory.pop();
                const prevView = navHistory[navHistory.length - 1];
                switchView(prevView, false);

                // Scroll to date if on timeline
                if (prevView === 'timeline') {
                    setTimeout(() => {
                        const el = $(`[data-date="${entry.date}"]`);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                }
            } else {
                switchView('timeline');
                // Scroll to date
                setTimeout(() => {
                    const el = $(`[data-date="${entry.date}"]`);
                    if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
        }

        function clearEntryForm() {
            $('#entry-form').reset();
            $('#entry-date').value = getLocalDateString();
            $('#entry-id').value = '';
            $('#entry-takeaways').value = '';
            $('#takeaways-group').style.display = 'none';
            editingEntryId = null;
        }

        function editEntry(id) {
            openEntryModal(null, id);
        }

        function deleteEntry(id) {
            if (!confirm('Delete this entry?')) return;
            entries = entries.filter(e => e.id !== id);
            Store.set('entries', entries);
            toast('Entry deleted');
            render();

            // Re-render current view if needed
            if (currentView === 'entries') renderEntries();
            if (currentView === 'coaching') renderCoaching();
            if (currentView === 'person-detail') renderPersonEntries();
        }

        function updateFormSelects() {
            // Render category radio buttons - first one selected by default
            $('#category-radios').innerHTML = categories.map((c, i) => `
                <input type="radio" class="category-radio" name="entry-category" id="cat-${c.id}" value="${c.id}" ${i === 0 ? 'checked' : ''}>
                <label class="category-radio-label" for="cat-${c.id}">
                    <span class="category-radio-dot" style="background:${c.color}"></span>
                    ${c.name}
                </label>
            `).join('');

            // Show/hide takeaways based on category selection
            $$('.category-radio').forEach(r => r.addEventListener('change', () => {
                $('#takeaways-group').style.display = r.value === 'coaching' && r.checked ? 'block' : 'none';
            }));

            $('#people-list').innerHTML = people.map(p => `<option value="${p.name}">`).join('');
        }

        function getSelectedCategory() {
            const checked = $('input[name="entry-category"]:checked');
            return checked ? checked.value : categories[0]?.id;
        }

        // People
        function openPersonModal(p = null) {
            if (p) {
                $('#person-modal-title').textContent = 'Edit Person';
                $('#person-id').value = p.id;
                $('#person-name').value = p.name;
                $('#person-role').value = p.role;
                $('#person-notes').value = p.notes || '';
            } else {
                $('#person-modal-title').textContent = 'Add Person';
                $('#person-form').reset();
                $('#person-id').value = '';
            }
            $('#person-modal').classList.add('active');
        }

        function savePerson() {
            const id = $('#person-id').value || Date.now().toString();
            const person = { id, name: $('#person-name').value, role: $('#person-role').value, notes: $('#person-notes').value };
            const idx = people.findIndex(p => p.id === id);
            if (idx >= 0) { people[idx] = person; toast('Person updated'); }
            else { people.push(person); toast('Person added'); }
            Store.set('people', people);
            closeModal('person-modal');
            render();
        }

        function viewPerson(id) {
            selectedPersonId = id;
            const p = people.find(x => x.id === id);
            if (!p) return;
            $('#detail-avatar').textContent = initials(p.name);
            $('#detail-name').textContent = p.name;
            $('#detail-role').textContent = roleLabel(p.role);
            renderPersonEntries();
            switchView('person-detail');
        }

        // Categories
        function addCategory() {
            categories.push({ id: Date.now().toString(), name: 'New Category', color: COLORS[Math.floor(Math.random() * COLORS.length)], isAccolade: false });
            Store.set('categories', categories);
            renderCategories();
        }

        function openColorModal(id) {
            editingCatId = id;
            const cat = categories.find(c => c.id === id);
            $$('.color-opt').forEach(o => o.classList.toggle('selected', o.dataset.c === cat?.color));
            $('#color-modal').classList.add('active');
        }

        // Render
        function render() {
            renderTimeline();
            renderPeople();
            renderSidebarCalendar();
            setupTimelineScrollObserver();
            $('#entry-count').textContent = `${entries.filter(e => parseLocalDate(e.date).getFullYear() === currentYear).length} entries`;
        }

        // Category icons mapping
        const CATEGORY_ICONS = {
            'coaching': '',
            'accolades': '',
            'presentation': '',
            'mentoring': '',
            'other': ''
        };

        // Timeline filter state
        let timelineFilter = 'all';

        function getEntryIcon(categoryId) {
            return CATEGORY_ICONS[categoryId] || '';
        }

        function renderTimeline() {
            const wrapper = $('#timeline-wrapper');
            const allYearEntries = entries.filter(e => parseLocalDate(e.date).getFullYear() === currentYear && smartSearchMatch(e, searchQuery));

            // Apply timeline filter
            const yearEntries = timelineFilter === 'all'
                ? allYearEntries
                : allYearEntries.filter(e => e.categoryId === timelineFilter);

            // Group by date
            const byDate = {};
            yearEntries.forEach(e => { byDate[e.date] = byDate[e.date] || []; byDate[e.date].push(e); });

            // Group all entries by month for stats
            const byMonth = {};
            allYearEntries.forEach(e => {
                const m = parseLocalDate(e.date).getMonth();
                byMonth[m] = byMonth[m] || [];
                byMonth[m].push(e);
            });

            // Days in year
            const isLeap = (currentYear % 4 === 0 && currentYear % 100 !== 0) || currentYear % 400 === 0;
            const daysInMonth = [31, isLeap ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];

            const todayStr = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().getMonth();

            // Build filter chips
            let html = `
                <div class="timeline-filters">
                    <button class="timeline-filter-chip ${timelineFilter === 'all' ? 'active' : ''}" data-filter="all">All</button>
                    ${categories.map(c => `
                        <button class="timeline-filter-chip ${timelineFilter === c.id ? 'active' : ''}" data-filter="${c.id}">
                            <span class="chip-dot" style="background:${c.color}"></span>
                            ${c.name}
                        </button>
                    `).join('')}
                </div>
            `;

            html += '<div class="timeline-line"></div>';

            // Motivational messages for empty months
            const emptyMonthMessages = [
                "Start the year strong! Add your first entry.",
                "What did you accomplish this month?",
                "Track your growth - add an entry!",
                "Spring into action! Log your achievements.",
                "Halfway there! Keep the momentum going.",
                "Summer of success - what have you achieved?",
                "Keep building your story!",
                "Document your wins this month!",
                "Fall into good habits - track your progress!",
                "What are you proud of this month?",
                "Almost there! Finish the year strong.",
                "Celebrate your growth this year!"
            ];

            for (let m = 0; m < 12; m++) {
                const monthEntryCount = (byMonth[m] || []).length;
                const filteredMonthCount = Object.keys(byDate).filter(d => {
                    const date = parseLocalDate(d);
                    return date.getMonth() === m;
                }).reduce((sum, d) => sum + (byDate[d]?.length || 0), 0);

                html += `<div class="month-section" data-month="${m}">
                    <div class="month-label">
                        ${monthNames[m]}
                        ${monthEntryCount > 0 ? `<span class="month-entry-count">${monthEntryCount} ${monthEntryCount === 1 ? 'entry' : 'entries'}</span>` : ''}
                    </div>`;

                let hasAnyEntries = false;
                for (let d = 1; d <= daysInMonth[m]; d++) {
                    const dateStr = `${currentYear}-${String(m + 1).padStart(2, '0')}-${String(d).padStart(2, '0')}`;
                    const dayEntries = byDate[dateStr] || [];
                    const hasEntries = dayEntries.length > 0;
                    if (hasEntries) hasAnyEntries = true;
                    const isToday = dateStr === todayStr;
                    const entryCount = dayEntries.length;

                    // Get colors for multi-color notch
                    const colors = dayEntries.map(e => categories.find(c => c.id === e.categoryId)?.color || '#8E8E93');
                    const notchStyle = colors.length === 1 ? `background:${colors[0]}` : colors.length > 1 ? `background:linear-gradient(135deg,${colors.join(',')})` : '';
                    const multiClass = colors.length > 1 ? 'multi' : '';

                    html += `<div class="day-row ${hasEntries ? 'has-entries' : ''} ${isToday ? 'today' : ''}" data-date="${dateStr}" tabindex="-1">`;
                    html += `<span class="day-number">${d}</span>`;

                    // Entry count badge (only show for 2+ entries)
                    if (entryCount >= 2) {
                        html += `<span class="entry-count-badge">${entryCount}</span>`;
                    }

                    html += `<div class="notch ${multiClass}" style="${notchStyle}"></div>`;
                    if (hasEntries) html += `<div class="connector"></div>`;

                    html += `<div class="day-entries">`;
                    if (hasEntries) {
                        dayEntries.forEach(e => {
                            const cat = categories.find(c => c.id === e.categoryId);
                            const linkedPerson = e.personId ? people.find(p => p.id === e.personId) : null;
                            const personDisplay = linkedPerson ? linkedPerson.name : e.personName;
                            const isAccolade = cat?.isAccolade;
                            const isCoaching = e.categoryId === 'coaching';
                            const entryColor = cat?.color || '#8E8E93';
                            const icon = getEntryIcon(e.categoryId);
                            html += `
                                <div class="timeline-entry ${isAccolade ? 'accolade' : ''} ${isCoaching ? 'coaching-entry' : ''}" data-id="${e.id}" style="--entry-color: ${entryColor}">
                                    <div class="entry-category-row"><span class="entry-category-dot" style="background:${entryColor}"></span><span class="entry-cat-label">${cat?.name || 'Unknown'}</span></div>
                                    <div class="entry-title ${isAccolade ? 'gold' : ''}"><span class="entry-icon">${icon}</span>${esc(e.title)}</div>
                                    ${personDisplay ? `<div class="entry-person ${linkedPerson ? 'linked' : ''}">with ${esc(personDisplay)}</div>` : ''}
                                    ${isCoaching && e.takeaways ? `<div class="entry-takeaways"><div class="entry-takeaways-label">Key Takeaways</div>${esc(e.takeaways)}</div>` : ''}
                                    ${e.notes ? `<div class="entry-notes">${esc(e.notes)}</div>` : ''}
                                    <div class="entry-actions">
                                        <button class="entry-btn edit-btn" data-id="${e.id}">Edit</button>
                                        <button class="entry-btn delete delete-btn" data-id="${e.id}">Delete</button>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        // Quick add hint for empty days
                        html += `<div class="quick-add-hint" data-date="${dateStr}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            Add entry
                        </div>`;
                    }
                    html += `</div></div>`;
                }

                // Empty month message
                if (!hasAnyEntries && timelineFilter === 'all') {
                    html += `<div class="empty-month-message">${emptyMonthMessages[m]}</div>`;
                }

                html += `</div>`;
            }

            wrapper.innerHTML = html;

            // Filter chip click handlers
            $$('.timeline-filter-chip').forEach(chip => {
                chip.addEventListener('click', () => {
                    timelineFilter = chip.dataset.filter;
                    renderTimeline();
                });
            });

            // Entry actions
            $$('.timeline-entry .edit-btn').forEach(b => b.addEventListener('click', e => { e.stopPropagation(); editEntry(b.dataset.id); }));
            $$('.timeline-entry .delete-btn').forEach(b => b.addEventListener('click', e => { e.stopPropagation(); deleteEntry(b.dataset.id); }));

            // Quick add hint click
            $$('.quick-add-hint').forEach(hint => {
                hint.addEventListener('click', e => {
                    e.stopPropagation();
                    openEntryModal(hint.dataset.date);
                });
            });

            // Entry click to expand day
            $$('.timeline-entry').forEach(entry => {
                entry.addEventListener('click', e => {
                    if (e.target.closest('.entry-btn')) return;
                    const row = entry.closest('.day-row');
                    const wasExpanded = row.classList.contains('expanded');
                    $$('.day-row.expanded').forEach(r => r.classList.remove('expanded'));
                    if (!wasExpanded) {
                        row.classList.add('expanded');
                    }
                });
            });

            // Context menu on right-click
            $$('.timeline-entry').forEach(entry => {
                entry.addEventListener('contextmenu', e => {
                    e.preventDefault();
                    showContextMenu(e.clientX, e.clientY, entry.dataset.id);
                });
            });

            // Day click to expand or add
            $$('.day-row').forEach(row => {
                row.addEventListener('click', e => {
                    if (e.target.closest('.timeline-entry') || e.target.closest('.quick-add-hint')) return;
                    if (row.classList.contains('has-entries')) {
                        const wasExpanded = row.classList.contains('expanded');
                        $$('.day-row.expanded').forEach(r => r.classList.remove('expanded'));
                        if (!wasExpanded) row.classList.add('expanded');
                    } else {
                        openEntryModal(row.dataset.date);
                    }
                });
            });

            // Scroll to today
            setTimeout(() => {
                const today = $(`[data-date="${todayStr}"]`);
                if (today) today.scrollIntoView({ block: 'center' });
            }, 50);

            // Setup keyboard navigation
            setupTimelineKeyboard();
        }

        // Context menu functions
        let contextMenuEntryId = null;

        function showContextMenu(x, y, entryId) {
            contextMenuEntryId = entryId;
            const menu = $('#context-menu');
            menu.style.left = x + 'px';
            menu.style.top = y + 'px';
            menu.classList.add('visible');

            // Adjust if off screen
            const rect = menu.getBoundingClientRect();
            if (rect.right > window.innerWidth) {
                menu.style.left = (x - rect.width) + 'px';
            }
            if (rect.bottom > window.innerHeight) {
                menu.style.top = (y - rect.height) + 'px';
            }
        }

        function hideContextMenu() {
            $('#context-menu').classList.remove('visible');
            contextMenuEntryId = null;
        }

        function duplicateEntry(id) {
            const original = entries.find(e => e.id === id);
            if (!original) return;
            const newEntry = {
                ...original,
                id: Date.now().toString(),
                title: original.title + ' (copy)',
                createdAt: Date.now(),
                updatedAt: Date.now()
            };
            entries.push(newEntry);
            Store.set('entries', entries);
            render();
            toast('Entry duplicated');
        }

        function copyEntryAsText(id) {
            const entry = entries.find(e => e.id === id);
            if (!entry) return;
            const cat = categories.find(c => c.id === entry.categoryId);
            const text = `${entry.date} - ${cat?.name || 'Entry'}: ${entry.title}${entry.notes ? '\n' + entry.notes : ''}`;
            navigator.clipboard.writeText(text).then(() => toast('Copied to clipboard'));
        }

        // Keyboard navigation for timeline
        let keyboardFocusedRow = null;

        function setupTimelineKeyboard() {
            const timelineScroll = $('#timeline-scroll');
            if (!timelineScroll) return;

            // Make timeline focusable
            timelineScroll.setAttribute('tabindex', '0');

            timelineScroll.addEventListener('keydown', e => {
                if (currentView !== 'timeline') return;

                const rows = Array.from($$('.day-row.has-entries'));
                if (rows.length === 0) return;

                const currentIndex = keyboardFocusedRow ? rows.indexOf(keyboardFocusedRow) : -1;

                switch(e.key) {
                    case 'ArrowDown':
                    case 'j':
                        e.preventDefault();
                        navigateToRow(rows, currentIndex + 1);
                        break;
                    case 'ArrowUp':
                    case 'k':
                        e.preventDefault();
                        navigateToRow(rows, currentIndex - 1);
                        break;
                    case 'Enter':
                    case ' ':
                        e.preventDefault();
                        if (keyboardFocusedRow) {
                            const wasExpanded = keyboardFocusedRow.classList.contains('expanded');
                            $$('.day-row.expanded').forEach(r => r.classList.remove('expanded'));
                            if (!wasExpanded) keyboardFocusedRow.classList.add('expanded');
                        }
                        break;
                    case 'Escape':
                        e.preventDefault();
                        $$('.day-row.expanded').forEach(r => r.classList.remove('expanded'));
                        clearKeyboardFocus();
                        break;
                    case 'n':
                        e.preventDefault();
                        if (keyboardFocusedRow) {
                            openEntryModal(keyboardFocusedRow.dataset.date);
                        }
                        break;
                    case 'e':
                        e.preventDefault();
                        if (keyboardFocusedRow) {
                            const firstEntry = keyboardFocusedRow.querySelector('.timeline-entry');
                            if (firstEntry) editEntry(firstEntry.dataset.id);
                        }
                        break;
                }
            });
        }

        function navigateToRow(rows, index) {
            if (index < 0) index = 0;
            if (index >= rows.length) index = rows.length - 1;

            clearKeyboardFocus();
            keyboardFocusedRow = rows[index];
            if (keyboardFocusedRow) {
                keyboardFocusedRow.classList.add('keyboard-focus');
                keyboardFocusedRow.scrollIntoView({ block: 'center', behavior: 'smooth' });
            }
        }

        function clearKeyboardFocus() {
            if (keyboardFocusedRow) {
                keyboardFocusedRow.classList.remove('keyboard-focus');
            }
            keyboardFocusedRow = null;
        }

        // Today anchor button
        function setupTodayAnchor() {
            const todayAnchor = $('#today-anchor');
            const timelineScroll = $('#timeline-scroll');
            if (!todayAnchor || !timelineScroll) return;

            const todayStr = new Date().toISOString().split('T')[0];
            const todayRow = $(`[data-date="${todayStr}"]`);

            if (!todayRow) {
                todayAnchor.style.display = 'none';
                return;
            }

            timelineScroll.addEventListener('scroll', () => {
                if (currentView !== 'timeline') return;
                const todayRect = todayRow.getBoundingClientRect();
                const containerRect = timelineScroll.getBoundingClientRect();

                // Show button if today is not visible
                const isVisible = todayRect.top >= containerRect.top && todayRect.bottom <= containerRect.bottom;
                todayAnchor.classList.toggle('visible', !isVisible);
            });

            todayAnchor.addEventListener('click', () => {
                todayRow.scrollIntoView({ block: 'center', behavior: 'smooth' });
            });
        }

        function renderEntries(resetCalendar = false) {
            // Only sync calendar year when explicitly reset (e.g., switching years via dropdown)
            if (resetCalendar) {
                calendarYear = currentYear;
                calendarMonth = new Date().getMonth();
                selectedCalendarDate = null;
            }

            // Filter bar
            $('#filter-bar').innerHTML = `<button class="filter-btn ${currentFilter === 'all' ? 'active' : ''}" data-f="all">All</button>` +
                categories.map(c => `<button class="filter-btn ${currentFilter === c.id ? 'active' : ''}" data-f="${c.id}"><span class="entry-category-dot" style="background:${c.color}"></span>${c.name}</button>`).join('');

            $$('#filter-bar .filter-btn').forEach(b => b.addEventListener('click', () => { currentFilter = b.dataset.f; selectedCalendarDate = null; renderEntries(); }));

            // Render calendar
            renderEntriesCalendar();

            // Filter entries
            let filtered = entries.filter(e => {
                if (parseLocalDate(e.date).getFullYear() !== currentYear) return false;
                if (currentFilter !== 'all' && e.categoryId !== currentFilter) return false;
                if (!smartSearchMatch(e, searchQuery)) return false;
                if (selectedCalendarDate && e.date !== selectedCalendarDate) return false;
                return true;
            }).sort((a, b) => parseLocalDate(b.date) - parseLocalDate(a.date));

            if (!filtered.length) {
                $('#entries-list').innerHTML = '<div class="empty-state"><p>No entries found</p></div>';
                return;
            }

            $('#entries-list').innerHTML = filtered.map(e => slimEntryCard(e)).join('');
            attachSlimCardActions();
        }

        function renderEntriesCalendar() {
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            // Get entries for this month
            const monthEntries = entries.filter(e => {
                const d = parseLocalDate(e.date);
                return d.getFullYear() === calendarYear && d.getMonth() === calendarMonth;
            });

            // Group by date
            const byDate = {};
            monthEntries.forEach(e => {
                byDate[e.date] = byDate[e.date] || [];
                byDate[e.date].push(e);
            });

            // Calculate calendar grid
            const firstDay = new Date(calendarYear, calendarMonth, 1).getDay();
            const daysInMonth = new Date(calendarYear, calendarMonth + 1, 0).getDate();
            const todayStr = new Date().toISOString().split('T')[0];

            let calendarHtml = `
                <div class="calendar-header">
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" id="cal-prev">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M15 18l-6-6 6-6"/></svg>
                        </button>
                        <span class="calendar-month-title">${monthNames[calendarMonth]} ${calendarYear}</span>
                        <button class="calendar-nav-btn" id="cal-next">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><path d="M9 18l6-6-6-6"/></svg>
                        </button>
                    </div>
                </div>
                <div class="calendar-grid">
                    ${weekdays.map(d => `<div class="calendar-weekday">${d}</div>`).join('')}
            `;

            // Empty cells before first day
            for (let i = 0; i < firstDay; i++) {
                calendarHtml += `<div class="calendar-day empty"></div>`;
            }

            // Days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${calendarYear}-${String(calendarMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const dayEntries = byDate[dateStr] || [];
                const hasEntries = dayEntries.length > 0;
                const isToday = dateStr === todayStr;
                const isSelected = dateStr === selectedCalendarDate;

                // Get unique category colors for dots (max 4)
                const dots = [...new Set(dayEntries.map(e => categories.find(c => c.id === e.categoryId)?.color || '#8E8E93'))].slice(0, 4);

                calendarHtml += `
                    <div class="calendar-day ${hasEntries ? 'has-entries' : ''} ${isToday ? 'today' : ''} ${isSelected ? 'selected' : ''}" data-date="${dateStr}">
                        <span class="calendar-day-num">${day}</span>
                        ${hasEntries ? `<div class="calendar-day-dots">${dots.map(c => `<div class="calendar-day-dot" style="background:${c}"></div>`).join('')}</div>` : ''}
                    </div>
                `;
            }

            calendarHtml += `</div>`;

            // Legend
            const usedCategories = [...new Set(monthEntries.map(e => e.categoryId))];
            if (usedCategories.length > 0) {
                calendarHtml += `<div class="calendar-legend">`;
                usedCategories.forEach(catId => {
                    const cat = categories.find(c => c.id === catId);
                    if (cat) {
                        calendarHtml += `<div class="legend-item"><div class="legend-dot" style="background:${cat.color}"></div>${cat.name}</div>`;
                    }
                });
                calendarHtml += `</div>`;
            }

            $('#entries-calendar').innerHTML = calendarHtml;

            // Calendar navigation
            $('#cal-prev').addEventListener('click', () => {
                calendarMonth--;
                if (calendarMonth < 0) { calendarMonth = 11; calendarYear--; }
                selectedCalendarDate = null;
                renderEntries();
            });
            $('#cal-next').addEventListener('click', () => {
                calendarMonth++;
                if (calendarMonth > 11) { calendarMonth = 0; calendarYear++; }
                selectedCalendarDate = null;
                renderEntries();
            });

            // Day click
            $$('#entries-calendar .calendar-day:not(.empty)').forEach(day => {
                day.addEventListener('click', () => {
                    const date = day.dataset.date;
                    if (selectedCalendarDate === date) {
                        selectedCalendarDate = null; // Deselect
                    } else {
                        selectedCalendarDate = date;
                    }
                    renderEntries();
                });
            });
        }

        function slimEntryCard(e) {
            const cat = categories.find(c => c.id === e.categoryId);
            const linkedPerson = e.personId ? people.find(p => p.id === e.personId) : null;
            const personDisplay = linkedPerson ? linkedPerson.name : e.personName;
            const isAccolade = cat?.isAccolade;
            const isCoaching = e.categoryId === 'coaching';
            const shortDate = parseLocalDate(e.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });

            return `
                <div class="entry-card-slim ${isAccolade ? 'accolade' : ''}" data-id="${e.id}">
                    <div class="entry-card-slim-header">
                        <div class="entry-card-slim-dot" style="background:${cat?.color || '#8E8E93'}"></div>
                        <div class="entry-card-slim-content">
                            <span class="entry-card-slim-title ${isAccolade ? 'gold' : ''}">${esc(e.title)}</span>
                            <div class="entry-card-slim-meta">
                                <span class="entry-card-slim-date">${shortDate}</span>
                                <span class="entry-card-slim-cat">${cat?.name || 'Other'}</span>
                            </div>
                        </div>
                        <svg class="entry-card-slim-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M6 9l6 6 6-6"/></svg>
                    </div>
                    <div class="entry-card-slim-details">
                        ${personDisplay ? `<div class="entry-card-slim-person ${linkedPerson ? 'linked' : ''}">with ${esc(personDisplay)}</div>` : ''}
                        ${isCoaching && e.takeaways ? `
                            <div class="entry-card-slim-takeaways">
                                <div class="entry-card-slim-takeaways-label">Key Takeaways</div>
                                <div class="entry-card-slim-takeaways-text">${esc(e.takeaways)}</div>
                            </div>
                        ` : ''}
                        ${e.notes ? `<div class="entry-card-slim-notes">${esc(e.notes)}</div>` : ''}
                        <div class="entry-card-slim-actions">
                            <button class="entry-btn edit-btn" data-id="${e.id}">Edit</button>
                            <button class="entry-btn delete delete-btn" data-id="${e.id}">Delete</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function attachSlimCardActions() {
            // Toggle expand/collapse
            $$('.entry-card-slim').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (e.target.closest('.entry-btn')) return; // Don't toggle on button click
                    card.classList.toggle('expanded');
                });
            });

            // Edit/Delete buttons
            $$('#entries-list .edit-btn').forEach(b => b.addEventListener('click', e => { e.stopPropagation(); editEntry(b.dataset.id); }));
            $$('#entries-list .delete-btn').forEach(b => b.addEventListener('click', e => { e.stopPropagation(); deleteEntry(b.dataset.id); }));
        }

        function entryCard(e) {
            const cat = categories.find(c => c.id === e.categoryId);
            const linkedPerson = e.personId ? people.find(p => p.id === e.personId) : null;
            const personDisplay = linkedPerson ? linkedPerson.name : e.personName;
            const isAccolade = cat?.isAccolade;
            const isCoaching = e.categoryId === 'coaching';
            return `
                <div class="entry-card ${isAccolade ? 'accolade' : ''} ${isCoaching ? 'coaching-entry' : ''}" style="--c:${cat?.color || '#8E8E93'}" data-id="${e.id}">
                    <style>.entry-card[data-id="${e.id}"]::before { background: var(--c); }</style>
                    <div class="entry-meta">
                        <div><span class="entry-category-dot" style="background:${cat?.color}"></span><span class="entry-cat-label">${cat?.name || ''}</span></div>
                        <span class="entry-date">${fmtDate(e.date)}</span>
                    </div>
                    <div class="entry-title ${isAccolade ? 'gold' : ''}">${esc(e.title)}</div>
                    ${personDisplay ? `<div class="entry-person ${linkedPerson ? 'linked' : ''}">with ${esc(personDisplay)}</div>` : ''}
                    ${isCoaching && e.takeaways ? `<div class="entry-takeaways"><div class="entry-takeaways-label">Key Takeaways</div>${esc(e.takeaways)}</div>` : ''}
                    ${e.notes ? `<div class="entry-notes">${esc(e.notes)}</div>` : ''}
                    <div class="entry-actions" style="opacity:1;margin-top:12px;">
                        <button class="entry-btn edit-btn" data-id="${e.id}">Edit</button>
                        <button class="entry-btn delete delete-btn" data-id="${e.id}">Delete</button>
                    </div>
                </div>
            `;
        }

        function attachEntryActions(sel) {
            $$(`${sel} .edit-btn`).forEach(b => b.addEventListener('click', e => { e.stopPropagation(); editEntry(b.dataset.id); }));
            $$(`${sel} .delete-btn`).forEach(b => b.addEventListener('click', e => { e.stopPropagation(); deleteEntry(b.dataset.id); }));
        }

        // Sidebar Mini Calendar
        function renderSidebarCalendar() {
            const calGrid = $('#sidebar-cal-grid');
            const calTitle = $('#sidebar-cal-title');
            if (!calGrid || !calTitle) return;

            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
            const weekdays = ['S', 'M', 'T', 'W', 'T', 'F', 'S'];

            // Get entries for this month with their category colors
            const monthEntries = entries.filter(e => {
                const d = parseLocalDate(e.date);
                return d.getFullYear() === sidebarCalYear && d.getMonth() === sidebarCalMonth;
            });

            // Group entries by date with their category colors
            const byDate = {};
            monthEntries.forEach(e => {
                if (!byDate[e.date]) byDate[e.date] = [];
                const cat = categories.find(c => c.id === e.categoryId);
                byDate[e.date].push(cat?.color || '#8E8E93');
            });

            const firstDay = new Date(sidebarCalYear, sidebarCalMonth, 1).getDay();
            const daysInMonth = new Date(sidebarCalYear, sidebarCalMonth + 1, 0).getDate();
            const todayStr = getLocalDateString();

            // Fade out, update, fade in
            calGrid.style.opacity = '0';
            calTitle.style.opacity = '0';

            setTimeout(() => {
                calTitle.textContent = `${monthNames[sidebarCalMonth]} ${sidebarCalYear}`;

                let html = weekdays.map(d => `<div class="sidebar-calendar-weekday">${d}</div>`).join('');

                for (let i = 0; i < firstDay; i++) {
                    html += `<div class="sidebar-calendar-day"></div>`;
                }

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateStr = `${sidebarCalYear}-${String(sidebarCalMonth + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const dayColors = byDate[dateStr] || [];
                    const hasEntries = dayColors.length > 0;
                    const isToday = dateStr === todayStr;

                    // Create colored dots (max 3)
                    const uniqueColors = [...new Set(dayColors)].slice(0, 3);
                    const dotsHtml = uniqueColors.length > 0
                        ? `<div class="sidebar-cal-dots">${uniqueColors.map(c => `<span class="sidebar-cal-dot" style="background:${c}"></span>`).join('')}</div>`
                        : '';

                    html += `<div class="sidebar-calendar-day ${hasEntries ? 'has-entries' : ''} ${isToday ? 'today' : ''}" data-date="${dateStr}">${day}${dotsHtml}</div>`;
                }

                calGrid.innerHTML = html;

                // Add click handlers to scroll to date in timeline
                calGrid.querySelectorAll('.sidebar-calendar-day[data-date]').forEach(dayEl => {
                    dayEl.addEventListener('click', () => {
                        const dateStr = dayEl.dataset.date;
                        const clickedDate = parseLocalDate(dateStr);

                        // Visual feedback - highlight selected day
                        calGrid.querySelectorAll('.sidebar-calendar-day.selected').forEach(el => el.classList.remove('selected'));
                        dayEl.classList.add('selected');

                        // Switch to the correct year if needed
                        if (clickedDate.getFullYear() !== currentYear) {
                            currentYear = clickedDate.getFullYear();
                            updateYearNav();
                            render();
                        }

                        // Make sure we're on timeline view
                        if (currentView !== 'timeline') {
                            switchView('timeline');
                        }

                        // Scroll to the date (try exact date first, then month)
                        setTimeout(() => {
                            const dayRow = $(`[data-date="${dateStr}"]`);
                            if (dayRow && dayRow.classList.contains('day-row')) {
                                dayRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            } else {
                                // If no exact date row, scroll to the month section
                                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                                const monthName = monthNames[clickedDate.getMonth()];
                                const monthSection = Array.from($$('.month-section')).find(s => s.querySelector('.month-label')?.textContent === monthName);
                                if (monthSection) {
                                    monthSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            }
                        }, 100);
                    });
                });

                // Fade back in
                calGrid.style.opacity = '1';
                calTitle.style.opacity = '1';
            }, 150);
        }

        // Setup timeline scroll observer for sidebar calendar
        function setupTimelineScrollObserver() {
            const timelineScroll = $('#timeline-scroll');
            if (!timelineScroll || isMobile()) return;

            // Clean up previous observer
            if (timelineScrollObserver) {
                timelineScrollObserver.disconnect();
            }

            timelineScrollObserver = new IntersectionObserver((observedEntries) => {
                observedEntries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio > 0.3) {
                        const monthLabel = entry.target.querySelector('.month-label');
                        if (monthLabel) {
                            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                            const monthIndex = monthNames.indexOf(monthLabel.textContent);
                            if (monthIndex !== -1 && (monthIndex !== sidebarCalMonth || currentYear !== sidebarCalYear)) {
                                sidebarCalMonth = monthIndex;
                                sidebarCalYear = currentYear;
                                renderSidebarCalendar();
                            }
                        }
                    }
                });
            }, { root: timelineScroll, threshold: 0.3 });

            $$('.month-section').forEach(section => timelineScrollObserver.observe(section));
        }

        function renderPeople() {
            const cards = people.map(p => {
                const count = entries.filter(e => e.personId === p.id).length;
                return `<div class="person-card" data-id="${p.id}">
                    <div class="person-avatar">${initials(p.name)}</div>
                    <div class="person-name">${esc(p.name)}</div>
                    <div class="person-role">${roleLabel(p.role)}</div>
                    <div class="person-stats">${count} session${count !== 1 ? 's' : ''}</div>
                </div>`;
            }).join('');

            $('#people-grid').innerHTML = cards + `<div class="add-card" id="add-person-card"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>Add Person</div>`;

            $$('.person-card').forEach(c => c.addEventListener('click', () => viewPerson(c.dataset.id)));
            $('#add-person-card').addEventListener('click', () => openPersonModal());
        }

        function renderPersonEntries() {
            const list = entries.filter(e => e.personId === selectedPersonId).sort((a, b) => parseLocalDate(b.date) - parseLocalDate(a.date));
            if (!list.length) {
                $('#person-entries').innerHTML = '<div class="empty-state"><p>No sessions yet</p></div>';
                return;
            }
            $('#person-entries').innerHTML = list.map(e => entryCard(e)).join('');
            attachEntryActions('#person-entries');
        }

        function renderCategories() {
            $('#category-list').innerHTML = categories.map(c => {
                const count = entries.filter(e => e.categoryId === c.id).length;
                const colorStyle = c.isAccolade ? '' : `background:${c.color}`;
                const goldClass = c.isAccolade ? 'gold' : '';
                return `<div class="category-item" data-id="${c.id}">
                    <div class="category-color ${goldClass}" style="${colorStyle}" data-id="${c.id}"></div>
                    <input class="category-name-input" value="${esc(c.name)}" data-id="${c.id}">
                    <span class="category-count">${count}</span>
                    <button class="category-delete" data-id="${c.id}"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
                </div>`;
            }).join('');

            $$('.category-color').forEach(el => el.addEventListener('click', () => openColorModal(el.dataset.id)));
            $$('.category-name-input').forEach(inp => inp.addEventListener('change', () => {
                const cat = categories.find(c => c.id === inp.dataset.id);
                if (cat) { cat.name = inp.value; Store.set('categories', categories); toast('Renamed'); render(); }
            }));
            $$('.category-delete').forEach(btn => btn.addEventListener('click', () => {
                const count = entries.filter(e => e.categoryId === btn.dataset.id).length;
                if (count) { alert(`Can't delete: ${count} entries use this`); return; }
                categories = categories.filter(c => c.id !== btn.dataset.id);
                Store.set('categories', categories);
                renderCategories();
                toast('Deleted');
            }));
        }

        function renderSummary() {
            const yearEntries = entries.filter(e => parseLocalDate(e.date).getFullYear() === currentYear);
            const stats = [
                { v: yearEntries.length, l: 'Total Entries' },
                { v: new Set(yearEntries.filter(e => e.personId).map(e => e.personId)).size, l: 'People' },
                { v: yearEntries.filter(e => categories.find(c => c.id === e.categoryId)?.isAccolade).length, l: 'Accolades' }
            ];
            $('#summary-grid').innerHTML = stats.map(s => `<div class="stat-card"><div class="stat-value">${s.v}</div><div class="stat-label">${s.l}</div></div>`).join('');

            const max = Math.max(...categories.map(c => yearEntries.filter(e => e.categoryId === c.id).length), 1);
            $('#breakdown-list').innerHTML = categories.map(c => {
                const count = yearEntries.filter(e => e.categoryId === c.id).length;
                return `<div class="breakdown-row">
                    <div class="breakdown-dot" style="background:${c.color}"></div>
                    <span class="breakdown-label">${c.name}</span>
                    <div class="breakdown-bar"><div class="breakdown-fill" style="width:${(count/max)*100}%;background:${c.color}"></div></div>
                    <span class="breakdown-count">${count}</span>
                </div>`;
            }).join('');
        }

        // Utils
        function fmtDate(d) {
            // Parse as local time by adding T00:00:00 to avoid UTC timezone shift
            const date = new Date(d + 'T00:00:00');
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }
        function initials(n) { return n.split(' ').map(x => x[0]).join('').toUpperCase().slice(0, 2); }
        function roleLabel(r) { return { mentee: 'Mentee', coachee: 'Coachee', peer: 'Peer', manager: 'Manager', other: 'Other' }[r] || r; }
        function esc(s) { return s ? s.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;') : ''; }
        function closeModal(id) { $(`#${id}`).classList.remove('active'); }
        function toast(m) { const t = $('#toast'); t.textContent = m; t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2500); }

        // Entry Modal Functions
        let editingModalEntryId = null;
        let customCategoryColor = '#8E8E93'; // Default grey

        function openEntryModal(dateStr = null, entryId = null) {
            const modal = $('#entry-modal');
            const form = $('#entry-modal-form');

            // Reset form
            form.reset();
            editingModalEntryId = entryId;
            customCategoryColor = '#8E8E93';

            // Update title
            $('#entry-modal-title').textContent = entryId ? 'Edit Entry' : 'Add Entry';

            // Hide custom category box initially
            $('#custom-category-box').classList.remove('visible');
            $('#custom-category-name').value = 'Other';

            // Populate category radios (existing + "Other +" option)
            const catContainer = $('#modal-category-radios');
            catContainer.innerHTML = categories.map((c, i) => `
                <input type="radio" name="modal-category" id="modal-cat-${c.id}" value="${c.id}" class="cat-radio" style="display:none" ${i === 0 ? 'checked' : ''}>
                <label for="modal-cat-${c.id}" class="cat-radio-label" style="color:${c.color}">${c.name}</label>
            `).join('') + `
                <input type="radio" name="modal-category" id="modal-cat-custom" value="__custom__" class="cat-radio" style="display:none">
                <label for="modal-cat-custom" class="cat-radio-label" style="color:#8E8E93">Other +</label>
            `;

            // Populate color picker
            const colorPicker = $('#custom-color-picker');
            colorPicker.innerHTML = COLORS.map(c => `
                <div class="custom-color-opt ${c === '#8E8E93' ? 'selected' : ''}" data-color="${c}" style="background:${c}"></div>
            `).join('');

            // Color picker click handlers
            colorPicker.querySelectorAll('.custom-color-opt').forEach(opt => {
                opt.addEventListener('click', () => {
                    colorPicker.querySelectorAll('.custom-color-opt').forEach(o => o.classList.remove('selected'));
                    opt.classList.add('selected');
                    customCategoryColor = opt.dataset.color;
                    // Update the "Other +" label color
                    $('label[for="modal-cat-custom"]').style.color = customCategoryColor;
                });
            });

            // Show/hide takeaways and custom category box based on selection
            catContainer.querySelectorAll('.cat-radio').forEach(radio => {
                radio.addEventListener('change', () => {
                    $('#modal-takeaways-group').style.display = radio.value === 'coaching' ? 'block' : 'none';
                    $('#custom-category-box').classList.toggle('visible', radio.value === '__custom__');
                    if (radio.value === '__custom__') {
                        setTimeout(() => $('#custom-category-name').focus(), 100);
                    }
                });
            });

            // Populate people datalist
            $('#modal-people-list').innerHTML = people.map(p => `<option value="${p.name}">`).join('');

            // Set date
            $('#modal-entry-date').value = dateStr || getLocalDateString();

            // If editing, populate fields
            if (entryId) {
                const entry = entries.find(e => e.id === entryId);
                if (entry) {
                    $('#modal-entry-date').value = entry.date;
                    $('#modal-entry-title').value = entry.title;
                    const person = entry.personId ? people.find(p => p.id === entry.personId) : null;
                    $('#modal-entry-person').value = person ? person.name : (entry.personName || '');
                    $('#modal-entry-notes').value = entry.notes || '';
                    $('#modal-entry-takeaways').value = entry.takeaways || '';
                    $('#modal-entry-id').value = entry.id;

                    // Select category
                    const catRadio = $(`#modal-cat-${entry.categoryId}`);
                    if (catRadio) {
                        catRadio.checked = true;
                        $('#modal-takeaways-group').style.display = entry.categoryId === 'coaching' ? 'block' : 'none';
                    }
                }
            }

            // Show modal with animation
            modal.classList.add('active');

            // Focus title after animation
            setTimeout(() => $('#modal-entry-title').focus(), 400);
        }

        function closeEntryModal() {
            const modal = $('#entry-modal');
            modal.classList.add('closing');
            setTimeout(() => {
                modal.classList.remove('active', 'closing');
                editingModalEntryId = null;
            }, 300);
        }

        function saveEntryFromModal() {
            const id = $('#modal-entry-id').value || Date.now().toString();
            const personInput = $('#modal-entry-person').value.trim();
            const matchedPerson = personInput ? people.find(p => p.name.toLowerCase() === personInput.toLowerCase()) : null;

            const selectedCat = $('input[name="modal-category"]:checked');
            let categoryId = selectedCat ? selectedCat.value : categories[0]?.id;

            // Handle custom category
            if (categoryId === '__custom__') {
                const customName = $('#custom-category-name').value.trim() || 'Other';
                // Check if category with this name already exists
                let existingCat = categories.find(c => c.name.toLowerCase() === customName.toLowerCase());
                if (!existingCat) {
                    // Create new category
                    const newCat = {
                        id: 'custom_' + Date.now(),
                        name: customName,
                        color: customCategoryColor,
                        isAccolade: false
                    };
                    categories.push(newCat);
                    Store.set('categories', categories);
                    categoryId = newCat.id;
                } else {
                    categoryId = existingCat.id;
                }
            }

            const entry = {
                id,
                date: $('#modal-entry-date').value,
                categoryId: categoryId,
                title: $('#modal-entry-title').value,
                personId: matchedPerson ? matchedPerson.id : null,
                personName: matchedPerson ? null : (personInput || null),
                takeaways: $('#modal-entry-takeaways').value || null,
                notes: $('#modal-entry-notes').value,
                createdAt: editingModalEntryId ? entries.find(e => e.id === editingModalEntryId)?.createdAt : Date.now(),
                updatedAt: Date.now()
            };

            if (editingModalEntryId) {
                entries[entries.findIndex(e => e.id === editingModalEntryId)] = entry;
                toast('Entry updated');
            } else {
                entries.push(entry);
                toast('Entry saved');
            }

            Store.set('entries', entries);
            closeEntryModal();

            // Update view to show the entry's year
            const savedDate = parseLocalDate(entry.date);
            currentYear = savedDate.getFullYear();
            calendarYear = currentYear;
            sidebarCalYear = currentYear;
            sidebarCalMonth = savedDate.getMonth();
            updateYearNav();
            render();

            // Scroll to entry
            setTimeout(() => {
                const el = $(`[data-date="${entry.date}"]`);
                if (el) el.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }, 100);
        }

        function setupEntryModal() {
            // Form submit
            $('#entry-modal-form').addEventListener('submit', e => {
                e.preventDefault();
                saveEntryFromModal();
            });

            // Close button
            $('#entry-modal-close').addEventListener('click', closeEntryModal);
            $('#modal-cancel-entry').addEventListener('click', closeEntryModal);

            // Click outside to close
            $('#entry-modal').addEventListener('click', e => {
                if (e.target.id === 'entry-modal') closeEntryModal();
            });

            // Escape key to close
            document.addEventListener('keydown', e => {
                if (e.key === 'Escape' && $('#entry-modal').classList.contains('active')) {
                    closeEntryModal();
                }
            });
        }

        // ===== Tutorial System =====
        const TutorialSystem = {
            currentStep: 0,
            isActive: false,
            waitingForAction: false,

            steps: [
                {
                    id: 'welcome',
                    title: 'Welcome to PGR Tracker!',
                    text: 'This app is an organization tool you can use to track events throughout your work year to aid in your personal development.',
                    target: null,
                    position: 'center',
                    nextText: 'Next'
                },
                {
                    id: 'timeline',
                    title: 'This is the Timeline',
                    text: 'Your entries for various events, coachings, accolades, and more will show here organized by month.',
                    target: '.main',
                    position: 'inside',
                    nextText: 'Next'
                },
                {
                    id: 'calendar',
                    title: 'Navigate with the Calendar',
                    text: 'Use the calendar to quickly jump to any date. Click on a day to scroll to that date in the timeline. Use the arrows to navigate between months and years.',
                    target: () => isMobile() ? null : '#sidebar-calendar',
                    skipOnMobile: true,
                    position: 'right',
                    nextText: 'Next'
                },
                {
                    id: 'fab',
                    title: 'Add New Entries',
                    text: "Here's where you can add new entries. Let's try it now! Click on the + button.",
                    target: '#fab',
                    position: 'top-left',
                    waitForClick: '#fab',
                    nextText: 'Click the + button'
                },
                {
                    id: 'modal-category',
                    title: 'Choose a Category',
                    text: 'First, select a category for your entry. Categories help organize your achievements - like Coaching sessions, Presentations, Peer Mentoring, or Accolades.',
                    target: '.entry-modal',
                    highlightInner: '#modal-category-radios',
                    position: () => isMobile() ? 'inside' : 'right',
                    delay: 400, // Wait for modal animation
                    nextText: 'Next'
                },
                {
                    id: 'modal-fields',
                    title: 'Fill in the Details',
                    text: 'Add the date, a descriptive title, optionally who was involved, and any notes. The more detail you add, the better your Year End Review will be!',
                    target: '.entry-modal',
                    position: () => isMobile() ? 'inside' : 'right',
                    nextText: 'Next'
                },
                {
                    id: 'modal-save',
                    title: 'Save Your Entry',
                    text: "When you're done, click Save Entry. You can always edit or delete entries later. For now, click Cancel to continue the tutorial.",
                    target: '.entry-modal',
                    highlightInner: '.entry-modal-actions',
                    position: () => isMobile() ? 'inside' : 'right',
                    waitForClick: '#modal-cancel-entry',
                    nextText: 'Click Cancel'
                },
                {
                    id: 'open-sidebar-mobile',
                    title: 'Open the Menu',
                    text: "Let's explore other views. Tap the menu button to open the sidebar.",
                    target: '#mobile-menu-btn',
                    position: 'top',
                    waitForClick: '#mobile-menu-btn',
                    nextText: 'Tap Menu',
                    mobileOnly: true
                },
                {
                    id: 'all-entries',
                    title: 'All Entries View',
                    text: "Now let's check out the All Entries page where you can see all your entries in a list with a calendar overview.",
                    target: '[data-view="entries"]',
                    position: () => isMobile() ? 'bottom' : 'right',
                    waitForClick: '[data-view="entries"]',
                    nextText: 'Click All Entries'
                },
                {
                    id: 'entries-overview',
                    title: 'Your Entry List',
                    text: 'Here you can browse all entries, use the calendar to filter by date, and click any entry to edit or delete it.',
                    target: '#entries-view',
                    position: 'inside',
                    delay: 300, // Wait for view transition
                    nextText: 'Next'
                },
                {
                    id: 'open-sidebar-settings',
                    title: 'Open the Menu',
                    text: "Finally, let's look at an important feature. Tap the menu button to access settings.",
                    target: '#mobile-menu-btn',
                    position: 'top',
                    waitForClick: '#mobile-menu-btn',
                    nextText: 'Tap Menu',
                    mobileOnly: true
                },
                {
                    id: 'settings-nav',
                    title: 'Settings & Export',
                    text: "Click the Settings gear icon to access import/export options and the Year End Review.",
                    target: '#settings-btn',
                    position: 'right',
                    waitForClick: '#settings-btn',
                    nextText: 'Click Settings'
                },
                {
                    id: 'year-review',
                    title: 'Year End Review',
                    text: "The Year End Review button generates a formatted text summary of all your accomplishments for the year. It's perfect for performance reviews, resumes, or self-reflection. It exports your accolades, presentations, mentoring sessions, and more into an easy-to-read format!",
                    target: '#year-review-btn',
                    position: 'right',
                    delay: 250, // Wait for dropdown animation
                    nextText: 'Finish Tutorial'
                }
            ],

            init() {
                // Check if tutorial has been completed or skipped
                if (Store.get('tutorialCompleted')) return;

                // Show onboarding modal after a short delay
                setTimeout(() => {
                    $('#onboarding-modal').classList.add('active');
                }, 500);

                // Setup event listeners
                $('#start-tutorial-btn').addEventListener('click', () => this.start());
                $('#skip-tutorial-btn').addEventListener('click', () => this.skip());
                $('#tutorial-next').addEventListener('click', () => this.next());
                $('#tutorial-stop').addEventListener('click', () => this.stop());

                // Escape key to stop tutorial
                document.addEventListener('keydown', e => {
                    if (e.key === 'Escape' && this.isActive) {
                        this.stop();
                    }
                });

                // Restart tutorial button
                $('#restart-tutorial-btn').addEventListener('click', () => this.restart());
            },

            restart() {
                // Close settings dropdown
                $('#settings-dropdown').classList.remove('show');

                // Reset completion state
                Store.set('tutorialCompleted', false);

                // Start fresh
                this.currentStep = 0;
                this.isActive = true;

                // Reset delay flags
                this.steps.forEach(s => s._delayHandled = false);

                // Switch to timeline and start
                switchView('timeline');
                setTimeout(() => this.showStep(), 300);
            },

            start() {
                $('#onboarding-modal').classList.remove('active');
                this.isActive = true;
                this.currentStep = 0;

                // Make sure we're on the timeline view
                switchView('timeline');

                setTimeout(() => this.showStep(), 300);
            },

            skip() {
                $('#onboarding-modal').classList.remove('active');
                Store.set('tutorialCompleted', true);
            },

            stop() {
                this.isActive = false;
                this.waitingForAction = false;
                this.hideAllElements();
                Store.set('tutorialCompleted', true);

                // Close any open modals/dropdowns/sidebar
                closeEntryModal();
                $('#settings-dropdown').classList.remove('show');
                if (isMobile()) closeSidebar();
            },

            next() {
                if (this.waitingForAction) return;

                this.currentStep++;
                if (this.currentStep >= this.steps.length) {
                    this.complete();
                } else {
                    this.showStep();
                }
            },

            complete() {
                this.isActive = false;
                this.hideAllElements();
                Store.set('tutorialCompleted', true);

                // Close settings dropdown and sidebar
                $('#settings-dropdown').classList.remove('show');
                if (isMobile()) closeSidebar();

                // Return to timeline
                setTimeout(() => {
                    switchView('timeline');
                    showToast("You're all set! Start tracking your achievements.");
                }, 200);
            },

            showStep() {
                const step = this.steps[this.currentStep];

                // Skip mobile-only steps on desktop or desktop-only on mobile
                if (step.skipOnMobile && isMobile()) {
                    this.next();
                    return;
                }
                if (step.mobileOnly && !isMobile()) {
                    this.next();
                    return;
                }

                // Handle delay for animation timing
                if (step.delay && !step._delayHandled) {
                    step._delayHandled = true;
                    setTimeout(() => this.showStep(), step.delay);
                    return;
                }
                step._delayHandled = false; // Reset for potential replay

                const spotlight = $('#tutorial-spotlight');
                const card = $('#tutorial-card');
                const arrow = $('#tutorial-arrow');

                // Remove previous tutorial-target class
                const prevTarget = $('.tutorial-target');
                if (prevTarget) prevTarget.classList.remove('tutorial-target');

                // Remove previous inner highlight
                const prevInner = $('.tutorial-inner-highlight');
                if (prevInner) prevInner.classList.remove('tutorial-inner-highlight');

                // Get target element
                let targetSelector = typeof step.target === 'function' ? step.target() : step.target;
                let targetEl = targetSelector ? $(targetSelector) : null;

                // Add inner highlight if specified
                if (step.highlightInner) {
                    const innerEl = $(step.highlightInner);
                    if (innerEl) innerEl.classList.add('tutorial-inner-highlight');
                }

                // Update step indicators
                this.updateStepIndicators();

                // Update card content
                $('#tutorial-title').textContent = step.title;
                $('#tutorial-text').textContent = step.text;
                $('#tutorial-next').textContent = step.nextText || 'Next';

                // Position elements
                if (targetEl && step.position !== 'center') {
                    this.positionSpotlight(targetEl);
                    this.positionCard(targetEl, step.position);
                    spotlight.style.display = 'block';
                } else {
                    spotlight.style.display = 'none';
                    card.classList.add('center');
                    card.style.left = '';
                    card.style.top = '';
                    card.style.right = '';
                    card.style.bottom = '';
                }

                // Show elements
                setTimeout(() => {
                    card.classList.add('active');
                    if (targetEl && step.position !== 'center') {
                        spotlight.classList.add('active');
                    }
                }, 50);

                // Setup wait for click if needed
                if (step.waitForClick) {
                    this.waitingForAction = true;
                    $('#tutorial-next').style.opacity = '0.5';
                    $('#tutorial-next').style.pointerEvents = 'none';

                    let clickTarget = typeof step.waitForClick === 'function' ? step.waitForClick() : step.waitForClick;
                    const clickEl = $(clickTarget);

                    if (clickEl) {
                        // Elevate the clickable element
                        clickEl.classList.add('tutorial-target');

                        const handler = () => {
                            clickEl.removeEventListener('click', handler);
                            this.waitingForAction = false;
                            $('#tutorial-next').style.opacity = '';
                            $('#tutorial-next').style.pointerEvents = '';

                            // Wait for any animations/transitions
                            setTimeout(() => this.next(), 300);
                        };
                        clickEl.addEventListener('click', handler);
                    }
                } else {
                    this.waitingForAction = false;
                    $('#tutorial-next').style.opacity = '';
                    $('#tutorial-next').style.pointerEvents = '';
                }

                // Update arrow
                arrow.className = 'tutorial-arrow';
                if (step.position && step.position !== 'center' && step.position !== 'inside') {
                    const pos = typeof step.position === 'function' ? step.position() : step.position;
                    if (pos === 'bottom' || pos === 'top-left') arrow.classList.add('top');
                    else if (pos === 'top') arrow.classList.add('bottom');
                    else if (pos === 'left') arrow.classList.add('right');
                    else if (pos === 'right') arrow.classList.add('left');
                }
            },

            positionSpotlight(el) {
                const rect = el.getBoundingClientRect();
                const spotlight = $('#tutorial-spotlight');
                const padding = 8;

                spotlight.style.left = (rect.left - padding) + 'px';
                spotlight.style.top = (rect.top - padding) + 'px';
                spotlight.style.width = (rect.width + padding * 2) + 'px';
                spotlight.style.height = (rect.height + padding * 2) + 'px';
            },

            positionCard(el, position) {
                const rect = el.getBoundingClientRect();
                const card = $('#tutorial-card');
                const cardWidth = 340;
                const cardHeight = 200;
                const gap = 20;

                card.classList.remove('center');
                card.style.left = '';
                card.style.top = '';
                card.style.right = '';
                card.style.bottom = '';

                const pos = typeof position === 'function' ? position() : position;

                switch (pos) {
                    case 'bottom':
                        card.style.left = Math.max(16, Math.min(rect.left + rect.width/2 - cardWidth/2, window.innerWidth - cardWidth - 16)) + 'px';
                        card.style.top = Math.min(rect.bottom + gap, window.innerHeight - cardHeight - 16) + 'px';
                        break;
                    case 'top':
                    case 'top-left':
                        card.style.left = Math.max(16, Math.min(rect.left - cardWidth/2, window.innerWidth - cardWidth - 16)) + 'px';
                        card.style.top = Math.max(16, rect.top - cardHeight - gap) + 'px';
                        break;
                    case 'left':
                        card.style.left = Math.max(16, rect.left - cardWidth - gap) + 'px';
                        card.style.top = Math.max(16, Math.min(rect.top + rect.height/2 - cardHeight/2, window.innerHeight - cardHeight - 16)) + 'px';
                        break;
                    case 'right':
                        card.style.left = Math.min(rect.right + gap, window.innerWidth - cardWidth - 16) + 'px';
                        card.style.top = Math.max(16, Math.min(rect.top + rect.height/2 - cardHeight/2, window.innerHeight - cardHeight - 16)) + 'px';
                        break;
                    case 'inside':
                        // Position card inside the highlighted element (centered)
                        card.style.left = Math.max(16, rect.left + rect.width/2 - cardWidth/2) + 'px';
                        card.style.top = Math.max(16, Math.min(rect.top + rect.height/2 - cardHeight/2, window.innerHeight - cardHeight - 16)) + 'px';
                        break;
                    default:
                        card.classList.add('center');
                }
            },

            updateStepIndicators() {
                const container = $('#tutorial-steps');
                const mobile = isMobile();
                const visibleSteps = this.steps.filter(s => {
                    if (s.skipOnMobile && mobile) return false;
                    if (s.mobileOnly && !mobile) return false;
                    return true;
                });
                const totalSteps = visibleSteps.length;

                // Find the current step's index among visible steps
                let visibleIndex = 0;
                for (let i = 0; i < this.currentStep; i++) {
                    const s = this.steps[i];
                    if (s.skipOnMobile && mobile) continue;
                    if (s.mobileOnly && !mobile) continue;
                    visibleIndex++;
                }

                let html = '';
                for (let i = 0; i < totalSteps; i++) {
                    let classes = 'tutorial-step-dot';
                    if (i < visibleIndex) classes += ' completed';
                    if (i === visibleIndex) classes += ' active';
                    html += `<div class="${classes}"></div>`;
                }
                container.innerHTML = html;
            },

            hideAllElements() {
                $('#tutorial-spotlight').classList.remove('active');
                $('#tutorial-spotlight').style.display = 'none';
                $('#tutorial-card').classList.remove('active');
                // Remove tutorial-target class from any element
                const target = $('.tutorial-target');
                if (target) target.classList.remove('tutorial-target');
                // Remove inner highlight
                const inner = $('.tutorial-inner-highlight');
                if (inner) inner.classList.remove('tutorial-inner-highlight');
            }
        };

        init();
    </script>
</body>
</html>
